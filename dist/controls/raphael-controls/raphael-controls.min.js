function Discog(a){var b=a.settings,c=b.width,d=b.height,e=c/2,f=d/2,g=a.paper,h=g.set(),i=e+e/2,j=g.rect(0,0,i,i),k=g.rect(e-e/2,f-f/2,i,i);return j.node.id=a.idf+"discog-box1-"+a.lap.id,k.node.id=a.idf+"discog-box2-"+a.lap.id,h.push(j,k),h.attr({fill:b.fill,stroke:b.background,strokeWidth:2}),h}function Info(a){var b=a.settings,c=b.width,d=b.height,e=c/2,f=d/2,g=a.paper,h=g.set(),i=g.circle(e,f,e).attr({fill:b.fill,stroke:b.stroke,strokeWidth:b.strokeWidth}),j={fill:b.background,stroke:"none"},k=2.5,l=g.circle(e,f/2,e/k/1.5).attr(j),m=g.rect(e-e/(2*k),f,e/k,f-f/4).attr(j);return i.node.id=a.idf+"info-circle-"+a.lap.id,l.node.id="lap-info-dot-"+a.lap.id,m.node.id="lap-info-rect-"+a.lap.id,h.push(i,l,m),h}function Pause(a){var b=a.settings,c=b.width,d=b.height,e=a.paper,f=e.set(),g=e.rect(0,0,c/3,d).attr(a.attrs),h=e.rect(c-c/3,0,c/3,d).attr(a.attrs);return g.node.id=a.idf+"pause-rect0-"+a.lap.id,h.node.id=a.idf+"pause-rect1-"+a.lap.id,f.push(g,h),f}function Play(a){var b=a.settings,c=b.width,d=b.height,e=d/2,f=a.paper,g=f.path(["M",0,0,"L",c,e,"L",0,d,"z"]).attr(a.attrs);return g.node.id=a.idf+"play-"+a.lap.id,g}function Playlist(a){var b=a.settings.width,c=a.settings.height,d=c/2,e=a.paper,f=e.set(),g=c/3.75,h=e.rect(0,0,b,g),i=e.rect(0,d-g/2,b,g),j=e.rect(0,c-g,b,g);return h.node.id=a.idf+"playlist-button-bar1-"+a.lap.id,i.node.id=a.idf+"playlist-button-bar2-"+a.lap.id,j.node.id=a.idf+"playlist-button-bar3-"+a.lap.id,f.push(h,i,j).attr(a.attrs),f}function Seek(a,b){var c,d=a.settings.width,e=a.settings.height,f=d/2,g=e/2,h=.15,i=a.paper,j=["M",0,g,"L",f,e*h,"L",f,g,"L",d,e*h,"L",d,e*(1-h),"L",f,g,"L",f,e*(1-h),"z"];return c=b?i.path(j).transform(["r",180,f,g]):i.path(j),c.attr(a.attrs),c.node.id=a.idf+"seek-"+(b?"forward-":"backward-")+a.lap.id,c}function Seekbar(a){var b=a.settings,c=b.seekbar,d=c.width,e=c.height,f=b.strokeWidth,g=a.tooly,h=a.lap,i=h.audio,j=!1,k=h.$container,l=(a.$el,g.select(".lap-seekbar",k),e<b.height?(b.height-e)/2:0),m=6,n=a.paper;n.setSize(d+m,b.height);var o=n.set(),p=n.rect(m,l,d-m,e).attr({fill:c.trackFill,stroke:c.trackStroke,strokeWidth:f}),q=n.rect(m,l,g.scale(h.bufferFormatted(),0,100,m,d-m),e).attr({fill:c.levelFill,stroke:c.levelStroke,strokeWidth:f}),r="rect"===c.knobShape?n.rect(0,l,c.knobWidth,e):n.circle(0,b.height/2,c.knobWidth);return r.attr({fill:c.knobFill,stroke:c.knobStroke,strokeWidth:f}),o.push(p,q,r),p.node.id="lap-rc-seekbar-track"+a.lap.id,q.node.id="lap-rc-seekbar-progress"+a.lap.id,r.node.id="lap-rc-seekbar-playhead"+a.lap.id,o.mousedown(function(){j=!0}).mousemove(function(a){if(j){var b=a.offsetX<=m?m:a.offsetX;b=a.offsetX>=d-m?d-m:b,r.animate("rect"===c.knobShape?{x:b}:{cx:b})}}).mouseup(function(a){j&&(i.currentTime=g.scale(a.offsetX,0,d,0,i.duration),j=!1)}),i.addEventListener("progress",function(){q.animate({width:g.scale(h.bufferFormatted(),0,100,m,d-m)})}),i.addEventListener("timeupdate",function(){if(!j){var a=g.scale(i.currentTime,0,i.duration,m,d-m);r.animate("rect"===c.knobShape?{x:a}:{cx:a})}}),o}function Skip(a,b){var c=a.settings.width,d=a.settings.height,e=c/2,f=d/2,g=a.paper,h=g.set(),i=["M",0,0,"L",c,f,"L",0,d,"z"],j=b?g.path(i):g.path(i).transform(["r",180,e,f]),k=b?c-c/4:0,l=g.rect(k,0,c/4,d),m=b?"next-":"prev-";return j.node.id=a.idf+m+"tri-"+a.lap.id,l.node.id=a.idf+m+"rect-"+a.lap.id,h.push(j,l).attr(a.attrs),h}function VolumeButton(a){var b=a.settings,c=b.width,d=b.height,e=c/2,f=d/2,g=a.paper,h=g.set(),i=g.path(["M",0,f/2,"H",e/2,"L",e+e/4,0,"V",d,"L",e/2,f+f/2,"H",0,"z"]).attr(a.attrs),j=1.5,k=3,l=["M",c-e/k,f/k,"C",c,f/j,c,d-f/j,c-e/k,d-f/k],m={fill:"none",stroke:b.fill,strokeWidth:b.strokeWidth,strokeLineCap:"round"},n=g.path(l).transform(["t",-2.5,0,"s",.6]).attr(m),o=g.path(l).attr(m);return i.node.id="lap-rcf-volume-horn-"+a.lap.id,n.node.id="lap-rcs-volume-curve2-"+a.lap.id,o.node.id="lap-rcs-volume-curve3-"+a.lap.id,h.push(i,n,o),h}function VolumeSlider(a){var b=a.settings,c=b.volumeSlider,d=c.width,e=c.height,f=6,g=b.strokeWidth,h=a.tooly,i=a.lap.getSelector,j=a.lap.$container,k=a.$el,l=i(".lap-volume-wrapper",j).get(0),m=a.paper,n=e<b.height?(b.height-e)/2:0;m.setSize(d,b.height);var o=m.set(),p=m.rect(0,n,d,e).attr({fill:c.trackFill,stroke:c.trackStroke,strokeWidth:g}),q=m.rect(0,n,d*a.lap.audio.volume,e).attr({fill:c.levelFill,stroke:c.levelStroke,strokeWidth:g}),r="rect"===c.knobShape?m.rect(d*a.lap.audio.volume-2,n,f,e):m.circle(d*a.lap.audio.volume-2,b.height/2,f);return r.attr({fill:c.knobFill,stroke:c.knobStroke,strokeWidth:g}),p.node.id="lap-rc-volume-track"+a.lap.id,q.node.id="lap-rc-volume-level"+a.lap.id,r.node.id="lap-rc-volume-knob"+a.lap.id,o.push(p,q,r),o.mousedown(function(b){a.sliding=!0,q.animate({width:b.offsetX},20),r.animate("rect"===c.knobShape?{x:b.offsetX-2}:{cx:b.offsetX-2},20)}).mousemove(function(b){if(a.sliding){var e=b.target.getBoundingClientRect(),g=(b.clientX-e.left)/e.width*this.attrs.width+this.getBBox().x,i=h.scale(g,0,d,0,1).toFixed(2);if(isNaN(g))return;g=g>=d-2?d:g,g=.05>=i?0:g,i=i>=.99?1:i,q.animate({width:g},20);var j=0===g?g:g-2;j=g===d?d-f:j;try{r.animate("rect"===c.knobShape?{x:j}:{cx:j},20)}catch(b){}.666>=i&&a.volumeButton[2].hide(),i>.666&&a.volumeButton[2].show(),.333>=i&&a.volumeButton[1].hide(),i>.333&&a.volumeButton[1].show();try{a.lap.audio.volume=i}catch(b){}}}).mouseup(function(){a.sliding=!1}),l.addEventListener("mouseenter",function(){h.removeClass(k,"lap-hidden")}),l.addEventListener("mouseleave",function(){a.sliding||h.addClass(k,"lap-hidden")}),o}function Volume(a,b){var c=a.settings,d=c.width,e=c.height,f=d/2,g=e/2,h=a.paper.path(["M",0,0,"L",d,g,"L",0,e,"z"]).transform(["r",b?-90:90,f,g]).attr(a.attrs);return h.node.id=a.idf+"volume-"+(b?"up-":"down-")+a.lap.id,h}Lap.RaphaelControls=function(a,b,c){this.tooly=window.tooly||Lap.prototype.getTooly(),this.lap=a;var d=24,e=4*d,f={width:e,height:d/4,trackFill:"#eee",trackStroke:"none",levelFill:"#888",levelStroke:"none",knobFill:"#fff",knobStroke:"#ddd",knobWidth:6,knobShape:"circle"},g={padding:2,width:d,height:d,background:"#fff",fill:"#000",stroke:"#000",strokeWidth:1,scale:!0,scaleAmount:.95,seekStyle:"buttons",seekbar:f,volumeStyle:"slider",volumeSlider:f};return this.settings=this.tooly.extend(!0,{},g,b),c&&this.init(),this},Lap.RaphaelControls.prototype=function(){return{init:function(){var a=this,b=a.lap,c=a.settings;return a.id="lap-rc-",a.idf="lap-rcf-",a.ids="lap-rcs-",a.sliding=!1,a.attrs={fill:c.fill,stroke:c.stroke,strokeWidth:c.strokeWidth},a.draw("playPause"),a.draw("seekbar"),"bar"===c.seekStyle||(a.draw("seekBackward"),a.draw("seekForward")),a.draw("prev"),a.draw("next"),a.draw("info"),a.draw("playlist"),a.draw("discog"),"slider"===c.volumeStyle?(a.draw("volumeButton"),a.draw("volumeSlider")):(a.draw("volumeUp"),a.draw("volumeDown")),a.draw("download"),this.pause.hide(),b.registerCallbacks({togglePlay:function(){b.audio.paused?(a.pause.hide(),a.play.show()):(a.play.hide(),a.pause.show())}}),a},draw:function(a){try{if(this.$el=this.lap.$els[a],!(this.$el&&this.$el instanceof this.tooly.Selector)||this.$el.zilch())return this;this.$el=this.$el.get(0)}catch(b){}switch(this.paper=Raphael(this.$el,this.settings.width,this.settings.height),a){case"playPause":this.play=new Play(this),this.pause=new Pause(this);break;case"seekbar":this.seekbar=new Seekbar(this);break;case"seekBackward":this.seekBackward=new Seek(this,!1);break;case"seekForward":this.seekForward=new Seek(this,!0);break;case"prev":this.prev=new Skip(this,!1);break;case"next":this.next=new Skip(this,!0);break;case"volumeUp":this.volumeUp=new Volume(this,!0);break;case"volumeDown":this.volumeDown=new Volume(this,!1);break;case"volumeButton":this.volumeButton=new VolumeButton(this);break;case"volumeSlider":this.volumeSlider=new VolumeSlider(this);break;case"info":this.info=new Info(this);break;case"playlist":this.playlist=new Playlist(this);break;case"discog":this.discog=new Discog(this)}return this}}}();