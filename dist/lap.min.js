/*! lap v0.4.0 | Â© 2015 Joshua Kleckner | http://lokua.net/license-mit.html */
!function(){"use strict";angular.module("lnet.lap",["tooly"])}(),!function(){angular.module("lnet.lap").run(["$templateCache",function(a){"use strict";a.put("lap-controls.html",'<div ng-switch="isMobile" class="lap lap__player"><div class="lap__details"><div><span class="lap__detail lap__artist"></span><span class="lap__detail lap__album"></span></div><div><span class="lap__detail lap__track-number"></span><span class="lap__detail lap__track-title"></span></div></div><br/><div ng-switch-default="false" class="lap__controls"><div class="lap__control lap__non-v"><i class="lap__play-pause lap-i-play"></i></div><div data-lap-tooltip="previous track" class="lap__control lap__tooltip lap__non-v"><i class="lap__prev lap-i-prev"></i></div><div data-lap-tooltip="next track" class="lap__control lap__tooltip lap__non-v"><i class="lap__next lap-i-next"></i></div><div class="lap__read lap__non-v lap__current-time">00:00</div><div class="lap__prog-seek"><prog-seek class="prog-seek"></prog-seek></div><div class="lap__read lap__duration lap__non-v">00:00</div><div data-lap-tooltip="previous album" class="lap__control lap__tooltip lap__non-v"><i class="lap__prev-album lap-i-prev-album"></i></div><div data-lap-tooltip="show albums" class="lap__control lap__tooltip lap__non-v"><i ng-class="{active:discogActive}" ng-click="discogActive=!discogActive" class="lap__discog lap-i-discog"></i></div><div data-lap-tooltip="next album" class="lap__control lap__tooltip lap__non-v"><i class="lap__next-album lap-i-next-album"></i></div></div><div ng-switch-when="true" class="lap__controls lap--mobile"><section class="lap__mobile-section--1"><div class="lap__control"><i class="lap__prev lap-i-prev"></i></div><div class="lap__control"><i class="lap__play-pause lap-i-play"></i></div><div class="lap__control"><i class="lap__next lap-i-next"></i></div></section><section class="lap__mobile-section--2"><div class="lap__read lap__current-time">00:00</div><div class="lap__prog-seek"><prog-seek class="prog-seek"></prog-seek></div><div class="lap__read lap__duration">00:00</div></section><section class="lap__mobile-section--3"><div class="lap__control"><i ng-class="{active:discogActive}" ng-click="discogActive=!discogActive" class="lap__discog lap-i-discog"></i></div></section></div></div>'),a.put("lap-discog.html",'<div class="lap__discog__panel"><div ng-repeat="album in lib" ng-click="loadAlbum($index)" ng-class="{active:$index===lap.albumIndex}" class="lap__discog__item"><img ng-src="{{album.cover}}"/><aside>{{album.album}}</aside></div></div>'),a.put("lap-playlist.html",'<div class="lap__cover__container"><img ng-src="{{cover}}" class="lap__cover"/></div><div ng-show="showPlayist" class="lap__playlist__panel"><div class="lap__playlist__panel__inner"><div ng-repeat="track in tracklist" ng-class="{ &quot;lap__playlist__item--current&quot;: $index === lap.trackIndex }" ng-click="setTrack($index)" class="lap__playlist__item"><span class="lap__playlist__track-number">{{trackNumbers[$index]}} &nbsp;</span><span class="lap__playlist__track-title">{{track}}</span></div></div></div>')}])}(),function(){"use strict";function a(a,b,c,d,e){function f(a,b,c,e){return d.Handler.call(this),this.id=++g,this.element=a,this.container=a[0],this.settings=angular.extend({},this.defaultSettings,c),this.lib=b,e||this.initialize(),h.push(this),this}var g=g||0,h=[],i=/mp3|wav|ogg|aiff/i;return f.getInstance=function(a){var c=b.defer();return c.resolve(h[a]),c.promise},f.getLib=function(c){var e=b.defer();return"object"===d.type(c)?(e.resolve([c]),e.promise):"array"===d.type(c)?(e.resolve(c),e.promise):i.test(c)?(e.resolve([{files:c}]),e.promise):a.get(c).then(function(a){return e.resolve(a.data),e.promise},function(a){return e.reject(a)})},f.PluginConstructorError=function(a){Error.call(this)},f.PluginConstructorError.prototype=Error,f.prototype=new d.Handler,f.prototype.defaultSettings={callbacks:{},discogPlaylistExclusive:!0,plugins:[],prependTrackNumbers:!0,replacementText:void 0,startingAlbumIndex:0,startingTrackIndex:0,seekInterval:5,seekTime:250,selectors:{},selectorPrefix:"lap",trackNumberPostfix:" - ",useNativeProgress:!1,useNativeSeekRange:!1,useNativeVolumeRange:!1,volumeInterval:.05},f.prototype.selectors={state:{playlistItemCurrent:"lap__playlist__item--current",playing:"lap--playing",paused:"lap--paused",hidden:"lap--hidden"},album:"lap__album",artist:"lap__artist",buffered:"lap__buffered",cover:"lap__cover",currentTime:"lap__current-time",discog:"lap__discog",discogItem:"lap__discog__item",discogPanel:"lap__discog__panel",duration:"lap__duration",info:"lap__info",infoPanel:"lap__info-panel",next:"lap__next",nextAlbum:"lap__next-album",playPause:"lap__play-pause",playlist:"lap__playlist",playlistItem:"lap__playlist__item",playlistPanel:"lap__playlist__panel",playlistTrackNumber:"lap__playlist__track-number",playlistTrackTitle:"lap__playlist__track-title",prev:"lap__prev",prevAlbum:"lap__prev-album",progress:"lap__progress",seekBackward:"lap__seek-backward",seekForward:"lap__seek-forward",seekRange:"lap__seek-range",trackNumber:"lap__track-number",trackTitle:"lap__track-title",volumeButton:"lap__volume-button",volumeDown:"lap__volume-down",volumeRead:"lap__volume-read",volumeRange:"lap__volume-range",volumeUp:"lap__volume-up"},f.prototype.SEEKING=!1,f.prototype.VOLUME_CHANGING=!1,f.prototype.MOUSEDOWN_TIMER=0,f.prototype.PLAYING=!1,f.prototype.initialize=function(){this.plugins={},this.playlistPopulated=!1,this.albumIndex=this.settings.startingAlbumIndex,this.albumCount=this.lib.length,this.update(),this.initAudio(),this.initElements(),this.addAudioListeners(),e.isMobile()||this.addVolumeListeners(),this.addSeekListeners(),this.addListeners(),this.register(this.settings.callbacks),c.$broadcast("lnet.lap.instanceInitialized",this),this.trigger("load")},f.prototype.update=function(){var a=this,b=a.lib,c=b[a.albumIndex];if(a.trackIndex=a.settings.startingTrackIndex,a.playlistPopulated=!1,["artist","album","files","cover","tracklist","replacement"].forEach(function(b){a[b]=c[b]}),a.trackCount=a.files.length,void 0!==a.replacement){var e=a.replacement;if("string"===d.type(e)&&(e=[e,""]),"regexp"!==d.type(e[0])){var f=e[2];e[0]=new RegExp(e[0],void 0!==f?f:"g")}}return a.formatTracklist(),a},f.prototype.initAudio=function(){this.audio=new Audio,this.audio.preload="auto";var a=this.getFileType(),b=this.audio.canPlayType("audio/"+a);"probably"===b||"maybe"===b?(this.setSource(),this.audio.volume=e.isMobile()?.8:1):console.warn("This browser does not support "+a+" playback.")},f.prototype.setSource=function(){this.audio.src=this.files[this.trackIndex]},f.prototype.getFileType=function(){return d.extension(this.files[this.trackIndex])},f.prototype.initElements=function(){var a=this;a.els={},a.selectors=angular.extend({},a.selectors,a.settings.selectors),d.each(a.selectors,function(b,c){if("object"!==d.type(b)){var f=e.element("."+b,a.element);f.length&&(a.els[c]=f)}})},f.prototype.addAudioListeners=function(){var a=this,b=a.audio,c=a.els;return(c.buffered||a.settings.useNativeProgress&&c.progress)&&b.addEventListener("progress",function(){var b=+a.bufferFormatted();c.buffered&&c.buffered.html(b),nativeProgress&&(c.progress[0].value=b)}),c.currentTime&&b.addEventListener("timeupdate",function(){c.currentTime.html(a.currentTimeFormatted())}),c.duration&&b.addEventListener("durationchange",function(){c.duration.html(a.durationFormatted())}),!e.isMobile()&&c.volumeRead&&b.addEventListener("volumechange",function(){c.volumeRead.html(a.volumeFormatted())}),b.addEventListener("ended",function(){a.PLAYING&&(a.next(),a.audio.play())}),a},f.prototype.addListeners=function(){var a=this,b=a.els;b.playPause&&b.playPause.on("click",function(){a.togglePlay()}),b.prev&&b.prev.on("click",function(){a.prev()}),b.next&&b.next.on("click",function(){a.next()}),e.isMobile()||(b.volumeUp&&b.volumeUp.on("click",function(){a.incVolume()}),b.volumeDown&&b.volumeDown.on("click",function(){a.decVolume()})),b.prevAlbum&&b.prevAlbum.on("click",function(){a.prevAlbum()}),b.nextAlbum&&b.nextAlbum.on("click",function(){a.nextAlbum()}),b.discog&&b.discog.on("click",function(){a.trigger("discogClick")}),a.on("load",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.artist&&a.updateArtistEl(),b.album&&a.updateAlbumEl(),b.cover&&a.updateCover(),b.playPause&&(b.playPause.addClass(a.selectors.state.paused),a.on("play",function(){b.playPause.removeClass(a.selectors.state.paused).addClass(a.selectors.state.playing)}).on("pause",function(){b.playPause.removeClass(a.selectors.state.playing).addClass(a.selectors.state.paused)}))}).on("trackChange",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.currentTime&&b.currentTime.html(a.currentTimeFormatted()),b.duration&&b.duration.html(a.durationFormatted())}).on("albumChange",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.artist&&a.updateArtistEl(),b.album&&a.updateAlbumEl(),b.cover&&a.updateCover()})},f.prototype.addSeekListeners=function(){var a=this,b=a.els,c=a.audio,e=b.seekRange,f=a.settings.useNativeSeekRange&&e&&e.els.length>0;f?(c.addEventListener("timeupdate",function(b){a.SEEKING||(e.get(0).value=d.scale(c.currentTime,0,c.duration,0,100))}),e.on("mousedown",function(b){a.SEEKING=!0}).on("mouseup",function(b){var f=e.get(0);f.value||a.logger.debug("what the fuck! "+f),c.currentTime=d.scale(f.value,0,f.max,0,c.duration),a.trigger("seek"),a.SEEKING=!1})):[b.seekForward,b.seekBackward].forEach(function(b){b&&b.on("mousedown",function(b){a.SEEKING=!0,angular.element(b.target).hasClass(a.selectors.seekForward)?a.seekForward():a.seekBackward()}).on("mouseup",function(b){a.SEEKING=!1,clearTimeout(a.MOUSEDOWN_TIMER)})})},e.isMobile()||(f.prototype.addVolumeListeners=function(){var a=this,b=a.els,c=a.audio,d=b.volumeRange;a.settings.useNativeVolumeRange&&d&&d.els.length>0&&(c.addEventListener("volumechange",function(){a.VOLUME_CHANGING||(d.get(0).value=a.volumeFormatted())}),d.on("mousedown",function(){a.VOLUME_CHANGING=!0}).on("mouseup",function(){c.volume=.01*d.get(0).value,a.trigger("volumeChange"),a.VOLUME_CHANGING=!1}))},f.prototype.incVolume=function(){return this.setVolume(!0),this},f.prototype.decVolume=function(){return this.setVolume(!1),this},f.prototype.setVolume=function(a){var b=this.audio.volume,c=this.settings.volumeInterval;return a?this.audio.volume=b+c>=1?1:b+c:this.audio.volume=0>=b-c?0:b-c,this.trigger("volumeChange"),this},f.prototype.volumeFormatted=function(){return Math.round(100*this.audio.volume)}),f.prototype.registerPlugin=function(a,b){this.plugins[a]=b},f.prototype.updateTrackTitleEl=function(){return this.els.trackTitle.html(this.tracklist[this.trackIndex]),this},f.prototype.updateTrackNumberEl=function(){return this.els.trackNumber.html(+this.trackIndex+1),this},f.prototype.updateArtistEl=function(){return this.els.artist.html(this.artist),this},f.prototype.updateAlbumEl=function(){return this.els.album.html(this.album),this},f.prototype.updateCover=function(){return this.els.cover.get(0).src=this.cover,this},f.prototype.togglePlay=function(){return this.audio.paused?this.play():this.pause(),this.trigger("togglePlay"),this},f.prototype.play=function(){return this.audio.play(),this.PLAYING=!0,this.trigger("play"),this},f.prototype.pause=function(){return this.audio.pause(),this.PLAYING=!1,this.trigger("pause"),this},f.prototype.setTrack=function(a){0>=a?this.trackIndex=0:a>=this.trackCount?this.trackIndex=this.trackCount-1:this.trackIndex=a;var b=!this.audio.paused;return this.setSource(),b&&this.audio.play(),this.trigger("trackChange"),this},f.prototype.prev=function(){var a=!this.audio.paused;return this.trackIndex=this.trackIndex-1<0?this.trackCount-1:this.trackIndex-1,this.setSource(),a&&this.audio.play(),this.trigger("trackChange"),this},f.prototype.next=function(){var a=!this.audio.paused;return this.trackIndex=this.trackIndex+1>=this.trackCount?0:this.trackIndex+1,this.setSource(),a&&this.audio.play(),this.trigger("trackChange"),this},f.prototype.prevAlbum=function(){var a=!this.audio.paused;return this.albumIndex=this.albumIndex-1<0?this.albumCount-1:this.albumIndex-1,this.update(),this.trackIndex=0,this.setSource(),a&&this.audio.play(),this.trigger("albumChange"),this},f.prototype.nextAlbum=function(){var a=!this.audio.paused;return this.albumIndex=this.albumIndex+1>this.albumCount-1?0:this.albumIndex+1,this.update(),this.trackIndex=0,this.setSource(),a&&this.audio.play(),this.trigger("albumChange"),this},f.prototype.setAlbum=function(a){return 0>=a?this.albumIndex=0:a>=this.albumCount?this.albumIndex=this.albumCount-1:this.albumIndex=a,this.update(),this.setTrack(this.lib[this.albumIndex].startingTrackIndex||0),this.trigger("albumChange"),this},f.prototype.seekBackward=function(){if(!this.SEEKING)return this;var a=this;return this.MOUSEDOWN_TIMER=setInterval(function(){a.seek(a,!1)},a.settings.seekTime),a},f.prototype.seekForward=function(){if(!this.SEEKING)return this;var a=this;return this.MOUSEDOWN_TIMER=setInterval(function(){a.seek(a,!0)},a.settings.seekTime),a},f.prototype.formatTracklist=function(){if(d.truthy(this.tracklist))return this;for(var a=this,b=a.replacement,c=[],e=0;e<a.trackCount;e++)c[e]=d.sliceRel(d.stripExtension(a.files[e])),d.truthy(b)&&(c[e]=c[e].replace(b[0],b[1])),c[e]=c[e].trim();return a.tracklist=c,a},f.prototype.bufferFormatted=function(){if(!this.audio)return 0;var a,b=this.audio;try{a=b.buffered.end(b.buffered.length-1)}catch(c){return 0}var e=Math.round(d.scale(a,0,b.duration,0,100));return isNaN(e)?0:e},f.prototype.currentTimeFormatted=function(){if(isNaN(this.audio.duration))return"00:00";var a=d.formatTime(Math.floor(this.audio.currentTime.toFixed(1)));return this.audio.duration<3600||"00:00:00"===a?a.slice(3):a},f.prototype.durationFormatted=function(){if(isNaN(this.audio.duration))return"00:00";var a=d.formatTime(Math.floor(this.audio.duration.toFixed(1)));return this.audio.duration<3600||"00:00:00"===a?a.slice(3):a},f.prototype.trackNumberFormatted=function(a){var b=(""+this.trackCount).length-(""+a).length;return d.repeat("0",b)+a+this.settings.trackNumberPostfix},f}angular.module("lnet.lap").factory("Lap",a),a.$inject=["$http","$q","$rootScope","tooly","lapUtil"]}(),function(){"use strict";function a(a){function b(a){return a&&(1===a.nodeType||9===a.nodeType)}function c(a,c,d){var e;return e=d?(b(d)?d:d[0])[a](c):document[a](c),angular.element(e)}var d,e;return{isMobile:function(){return e||(e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i),e.test(navigator.userAgent)},safeApply:function(a){var b=a.$root.$$phase;"$apply"!==b&&"$digest"!==b&&a.$apply()},body:function(){return d||(d=this.element("body")),d},isNode:function(a){return b(a)},element:function(a,b){return c("querySelector",a,b)},elementAll:function(a,b){return c("querySelectorAll",a,b)}}}angular.module("lnet.lap").factory("lapUtil",a),a.$inject=["tooly"]}(),function(){"use strict";function a(a,b,c,d){return{restrict:"E",scope:{src:"@"},template:a.get("lap-controls.html"),link:function(a,b,e){return a.ready=!1,a.discogActive=!1,a.isMobile=d.isMobile(),e.hasOwnProperty("src")?void a.$watch("src",function(d){var e=d.charAt(0);("["===e||"{"===e)&&(d=a.$eval(d)),c.getLib(d).then(function(d){new c(b,d,{discogPlaylistExclusive:!0,plugins:[],prependTrackNumbers:!0,replacementText:void 0,startingAlbumIndex:0,startingTrackIndex:0,seekInterval:5,seekTime:250,selectors:{},selectorPrefix:"lap",trackNumberPostfix:" - ",useNativeProgress:!1,useNativeSeekRange:!1,useNativeVolumeRange:!1,volumeInterval:.05,callbacks:{load:function(){a.lap=this,a.ready=!0}}},!1,!0)})}):console.warn("lap-container needs a src attribute. Exiting.")}}}angular.module("lnet.lap").directive("lapContainer",a),a.$inject=["$templateCache","$parse","Lap","lapUtil"]}(),function(){"use strict";function a(a,b){return{restrict:"E",template:a.get("lap-discog.html"),scope:!0,link:function(a,b,c){function d(){e(),a.showDiscog=!0}function e(){a.lib=f.lib.map(function(a){return{cover:a.cover,album:a.album}})}var f,g=a.$watch("lap",function(a,b){a&&(f=a,logger.debug("watch >> lap: %o",f),d(),g())});a.loadAlbum=function(b){f.setAlbum(b),a.$emit("lnet.lap.discogItemChosen",!0)}}}}angular.module("lnet.lap").directive("lapDiscog",a),a.$inject=["$templateCache","tooly"]}(),function(){"use strict";function a(a,b,c){return{restrict:"E",template:a.get("lap-playlist.html"),scope:!0,link:function(a,d,e){function f(){g(),a.showPlayist=!0,h.on("albumChange",function(){g(),c.safeApply(a)}).on("trackChange",function(){c.safeApply(a)})}function g(){var c=String(h.trackCount).length;a.trackNumbers=h.tracklist.map(function(a,d){return b.lpad(String(d+1),c,"0")}),a.tracklist=h.tracklist,a.cover=h.cover}var h,i=a.$watch("lap",function(a,b){a&&(h=a,logger.debug("watch >> lap: %o",h),f(),i())});a.setTrack=function(a){h.setTrack(a)}}}}angular.module("lnet.lap").directive("lapPlaylist",a),a.$inject=["$templateCache","tooly","lapUtil"]}(),function(){"use strict";function a(a,c){function d(a,b){return angular.element('<div class="prog-seek__'+a+'" id="prog-seek__'+a+"--"+b+'">')}return{restrict:"E",link:function(a,e,f){var g,h,i,j=b++,k=d("container",j),l=d("inner",j),m=d("track",j),n=d("progress",j),o=d("handle",j),p=!1;if(a.options&&!angular.equals(a.options,{})){var q=a.options;q.progressColor&&n.css("background-color",q.progressColor),q.handleColor&&o.css("background-color",q.handleColor),q.trackColor&&m.css("background-color",q.trackColor)}e.append(k.append(l.append(m).append(n).append(o)));var r=a.$watch("ready",function(b,d){b&&(r(),h=a.$parent.lap,i=h.audio,g=new Dragdealer("prog-seek__container--"+j,{handleClass:"prog-seek__handle",dragStartCallback:function(a,b){p=!0},dragStopCallback:function(a,b){i.currentTime=c.scale(a,0,1,0,i.duration),p=!1}}),i.addEventListener("timeupdate",function(a){p||g.setValue(c.scale(i.currentTime,0,i.duration,0,1))}),i.addEventListener("progress",function(a){var b=+h.bufferFormatted();n.css("width",b+"%")}))})}}}angular.module("lnet.lap").directive("progSeek",a),a.$inject=["$timeout","tooly"];var b=b||0}(),function(a){"use strict";function b(a,b,c,d,e,f){return f.isMobile()?angular.noop:(e.VolumeRangeRevealer=function(a,b){var c=this;return c.lap=a,c.element=b,c},e.VolumeRangeRevealer.prototype.levelClasses=["lap-i-volume-off","lap-i-volume-low","lap-i-volume-mid","lap-i-volume-high","lap-i-volume-max"],e.VolumeRangeRevealer.prototype.init=function(a,c){function g(){k.element.addClass(l.selectors.state.hidden),q.removeClass(l.selectors.state.hidden)}var h,i,j,k=this,l=k.lap,m=angular.element(l.container)[0],n=f.element(".lap__speaker",m),o=(f.element(".lap__speaker__container",m),l.els.volumeRange),p=k.element[0].querySelector(".lap__volume-range__track").width,q=f.elementAll(".lap__non-v",m);if(!o||!o.length)throw new e.PluginContructorError("Lap.VolumeRangeRevealer cannot init without Lap#els.volumeRange element");o.on("mouseenter",function(){j=!0}).on("mousedown",function(){h=!0}).on("mousemove",function(a){if(h){var b=d.scale(a.offsetX,0,p,0,100),c=0;if(b>0){var e=d.scale(b,0,100,0,k.levelClasses.length-1);c=Math.ceil(e)}n.removeClass(k.levelClasses.filter(function(a){return a!==k.levelClasses[c]}).join(" ")).addClass(k.levelClasses[c])}}).on("mouseleave",function(){j=!1,h||g()}),n.on("mouseenter",function(){i||j||(k.element.removeClass(l.selectors.state.hidden),q.addClass(l.selectors.state.hidden),i=!0)}).on("mouseleave",function(a){i=!1,b(function(){i||j||g()},1e3)}),f.body().on("mouseup",function(){h=!1,j||i||g()}),l.registerPlugin("VolumeRangeRevealer",k)},{restrict:"A",link:function(a,b,c){var d,f=a.$watch("ready",function(g,h){g&&(d=new e.VolumeRangeRevealer(a.lap,b),f(),f=a.$watch("vRangeReady",function(b,e){b&&(d.init(a,c),f())}))})}})}angular.module("lnet.lap").directive("lapVolumeRangeRevealer",b),b.$inject=["$document","$timeout","$interval","tooly","Lap","lapUtil"]}(),function(){"use strict";function a(){function a(a,b){return angular.element('<div class="lap__volume-range__'+a+'" id="lap__volume-range__'+a+"--"+b+'">')}return{restrict:"E",link:function(c,d,e){var f,g,h,i=b++,j=a("container",i),k=a("inner",i),l=a("track",i),m=a("handle",i),n=!1;if(c.options&&!angular.equals(c.options,{})){var o=c.options;o.handleColor&&m.css("background-color",o.handleColor),o.trackColor&&l.css("background-color",o.trackColor)}d.append(j.append(k.append(l).append(m)));var p=c.$watch("ready",function(a,b){a&&(p(),g=c.$parent.lap,h=g.audio,f=new Dragdealer("lap-volume-range__container--"+i,{handleClass:"lap__volume-range__handle",dragStartCallback:function(a,b){n=!0,c.vrangeDragging=!0,c.$apply()},dragStopCallback:function(a,b){n=!1,c.vrangeDragging=!1,c.$apply()}}),c.vRangeReady=!0,h.addEventListener("volumeupdate",function(a){}))})}}}angular.module("lnet.lap").directive("lapVolumeRange",a),a.$inject=["tooly"];var b=b||0}();