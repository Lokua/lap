/**
 * lap - version 0.0.5 (built: 2014-10-01)
 * html5 audio player
 * https://github.com/Lokua/lap.git
 * Copyright (c) 2014 Joshua Kleckner <dev@lokua.net>
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/MIT
 */

!function(a,b){"function"==typeof define&&define.amd?define("Lap",[],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Lap=b()}(this,function(){function a(c,d,e){b.Handler.call(this);var f=this;f.name="Lokua Audio Player",f.version="0.0.5",f.doc="http://lokua.net/lap/0.0.5/doc/";{var g={trace:!1,debug:!1,startingTrackIndex:0,startingAlbumIndex:0,volumeInterval:.05,seekInterval:5,seekTime:250,prependTrackNumbers:!0,trackNumberPostfix:" - ",replacementText:void 0,elements:{albumTitle:".lap-album-title",artist:".lap-artist",buffered:".lap-buffered",control:".lap-control",controls:".lap-controls",cover:".lap-cover",currentTime:".lap-current-time",discog:".lap-discog",duration:".lap-duration",info:".lap-info",infoPanel:".lap-info-panel",next:".lap-next",nextAlbum:".lap-next-album",playPause:".lap-play-pause",playlist:".lap-playlist",playlistPanel:".lap-playlist-panel",playlistTrackNumber:".lap-playlist-track-number",prev:".lap-prev",prevAlbum:".lap-prev-album",seekBackward:".lap-seek-backward",seekForward:".lap-seek-forward",seekbar:".lap-seekbar",trackNumber:".lap-track-number",trackTitle:".lap-track-title",volumeButton:".lap-volume-button",volumeDown:".lap-volume-down",volumeRead:".lap-volume-read",volumeSlider:".lap-volume-slider",volumeUp:".lap-volume-up"},callbacks:{},plugins:{}};!function(){f.id=a.idGen++,f.settings=b.extend({},!0,g,e),f.$container=1===c.nodeType?c:b.select(c),f.lib=d,f.libType=b.toType(f.lib),f.files=[],f.trackTitles=[],f.$els=f.settings.elements,f.handlers={},f.audio={},f.trackIndex=f.settings.startingTrackIndex,f.albumIndex=f.settings.startingAlbumIndex,f.trackCount={},f.albumTitle="",f.trackTitle="",f.artist="",f.cover="",f.replacement="",f.updateCurrent(),f.initAudio(),f.initElements(g.elements),f.addListeners(),f.registerCallbacks(f.settings.callbacks),f.initPlugins(),f.load(),logger.debug("post initialize -> <instance>.id: %i, <instance>.*: %o",f.id,f)}()}return f}var b=function(){function a(a,b){return a={}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase(),b?a===b.toLowerCase():a}function c(a){return new RegExp("\\s*"+a+"\\s*(![\\w\\W])?","g")}function d(b,c,d){if("array"===a(c)){for(var e,f=0,g=b.length;g>f;f++)e=d(b[f],c);return e}}function e(b,c,d){if("array"===a(b))for(var e=0,f=b.length;f>e;e++)d(b[e],c)}function f(a,b,c){for(var d=a.className.split(j),e=0,f=d.length;f>e;e++)if(d[e].match(c)==b)return!0;return!1}function g(a,c){i(a)||(a=b.select(a)),a.innerHTML=c+a.innerHTML}function h(a,c){i(a)||(a=b.select(a)),a.innerHTML+=c}function i(a){return a&&(1===a.nodeType||9===a.nodeType)}var j=/\s+/;return{hasClass:function(d,e){if(a(d,"array"))for(var g=c(e),h=0,j=d.length;j>h;h++){var k=i(d[h])?d[h]:b.select(d[h]);if(f(k,e,g))return!0}return!1},addClass:function(c,f){return a(c,"array")?e(c,f,b.addClass):i(c)?c.className+=" "+f:c=b.select(c),d(c,f,b.addClass),b},removeClass:function(f,g){return a(f,"array")?e(f,g,b.removeClass):i(f)?f.className=f.className.replace(c(g)," "):f=b.select(f),d(f,g,b.removeClass),b},prepend:function(c,d){return a(c,"array")?(e(c,d,g),b):(g(c,d),b)},append:function(c,d){return a(c,"array")?(e(c,d,h),b):(h(c,d),b)},html:function(c,d){if(1===arguments.length)return"array"===a(c)&&i(c[0])?c[0].innerHTML:i(c)?c.innerHTML:b.select(c).innerHTML;if(!i(c)){if("array"===a(c)){for(var e=0,f=c.length;f>e;e++)i(c[e])?c[e].innerHTML=d:(c[e]=b.select(c[e]),c[e].innerHTML=d);return b}return b.select(c).innerHTML=d,b}return c.innerHTML=d,b},select:function(a,b){return(b||document).querySelector(a)},sel:function(a,c){return b.select(a,c)},selectAll:function(a,b){for(var c=(b||document).querySelectorAll(a),d=[],e=0,f=c.length;f>e;e++)d[e]=c[e];return d},selAll:function(a,c){return b.selectAll(a,c)},parent:function(a){return i(a)||(a=b.select(a)),null!=a?a.parentNode:null},children:function(a){return i(a)||(a=b.select(a)),null!=a?function(){for(var b=a.children,c=[],d=0,e=b.length;e>d;d++)c.push(b.item(d));return c}():null},css:function(c,d){var e=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])};if(a(c,"array")){if(3===arguments.length){for(var f=0,g=c.length;g>f;f++)c[f].style[arguments[1]]=arguments[2];return b}for(var f=0,g=c.length;g>f;f++)e(c[f],d);return b}return i(c)||(c=b.select(c)),3===arguments.length?c.style[arguments[1]]=arguments[2]:e(c,d),b},Selector:function(a){return this instanceof b.Selector?(this.el=b.selectAll(a),this):new b.Selector(a)},construct:function(b,c){function d(){return"array"===a(c)?b.apply(this,c):b.call(this,c)}return d.prototype=b.prototype,new d},extend:function(){var c,d,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"===a(i)&&(l=i,i=arguments[1]||{},j=2),"object"!==a(i)&&"function"!==a(i)&&(i={});k>j;j++)if(c=arguments[j],null!=c){"string"===a(c)&&(c=c.split(""));for(d in c)e=i[d],f=c[d],i!==f&&(l&&f&&(b.isHash(f)||(g="array"===a(f)))?(g?(g=!1,h=e&&"array"===a(e)?e:[]):h=e&&b.isHash(e)?e:{},i[d]=b.extend(l,h,f)):"undefined"!=typeof f&&(i[d]=f))}return i},fromPrototype:function(a,c){var d,e=b.objectCreate(a);for(d in c)c.hasOwnProperty(d)&&(e[d]=c[d]);return e},fromProto:function(a,c){return b.fromPrototype(a,c)},inherit:function(a,b,c){b.prototype=new a,b.prototype.constructor=b;for(var d in c)c.hasOwnProperty(d)&&(b.prototype[d]=c[d])},isHash:function(b){return"object"===a(b)&&b.constructor===Object&&!b.nodeType&&!b.setInterval},objectCreate:function(a){var b=function(){};return b.prototype=a,new b},propCount:function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},propsOf:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c},getJSON:function(a,c,d){b.get(a,"json",c,d)},get:function(a,b,c,d){var e=new XMLHttpRequest;e.open("get",a,3===arguments.length?!0:d),e.reponseType=b,e.onload=function(){4==e.readyState&&200==e.status&&c(e.response)},e.send()},endsWith:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},format:function(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},formatTime:function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=Math.floor(a-3600*b-60*c);return 10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),b+":"+c+":"+d},repeat:function(a,b){for(var c="",d=0;b>d;d++)c+=a;return c},scale:function(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d},sliceRel:function(a,b,c){var d=!1;return"/"===a.slice(-1)&&(d=!0,a=a.slice(0,-1)),a=a.slice(a.lastIndexOf("/")+1),d&&c&&(a=a.concat("/")),b&&(a="/"+a),a},extension:function(a){return a.substring(a.lastIndexOf(".")+1)},ext:function(a){return b.extension(a)},stripExtension:function(a){return a.substring(0,a.lastIndexOf("."))},stripExt:function(a){return b.stripExtension(a)},shit:function(a){console.error("shitError - something is fucking shit up: "+a)},toType:function(b,c){return a(b,c)},type:function(b,c){return a(b,c)},"typeof":function(b,c){return a(b,c)},Handler:function(a){return this instanceof b.Handler?(this.context=a||this,this.handlers=this.context.handlers={},this):new b.Handler(a)},Timer:function(a){return this instanceof b.Timer?(this.name=a||"Timer_instance_"+Date.now(),this):new b.Timer(a)},Logger:function(a,c){return this instanceof b.Logger?(this.level=void 0!==a?a:2,c&&(this.name=c),this.traceAnonymous=!1,this):new b.Logger(a,c)}}}();return b.Selector.prototype={hasClass:function(a){return b.hasClass(this.el,a),this},addClass:function(a){return b.addClass(this.el,a),this},removeClass:function(a){return b.removeClass(this.el,a),this},prepend:function(){return b.prepend(this.el),this},append:function(){return b.append(this.el),this},html:function(a){return b.html(this.el,a),this},parent:function(){return b.parent(this.el),this},children:function(){return b.children(this.el),this},css:function(){var a=[this.el];return Array.prototype.push.apply(a,arguments),b.css.apply(null,a),this}},b.Handler.prototype={on:function(a,b){return void 0===this.handlers[a]&&(this.handlers[a]=[]),this.handlers[a].push(b),this},removeAll:function(){this.handlers={}},remove:function(a){void 0!==this.handlers[a]&&(this.handlers[a].length=0)},off:function(a){this.remove(a)},executeHandler:function(a){for(var b=this.handlers[a]||[],c=0,d=b.length;d>c;c++)b[c].apply(this.context,[]);return this},exec:function(a){return this.executeHandler(a)},trigger:function(a){return this.executeHandler(a)},registerCallbacks:function(a){var b=this,c={};if(void 0!==a)for(c in a)a.hasOwnProperty(c)&&b.on(c,a[c]);return b},toString:function(){return"[Handler ' "+this+" ']"}},b.Timer.prototype=function(){var a,b,c;return{start:function(){a=Date.now()},stop:function(){return b=Date.now(),c=b-a},end:function(){return this.stop(),this.log(),c},log:function(){console.log(this.name+" "+c)}}}(),b.Logger.prototype=function(){function a(a,c,f,j){if(!(-1===a.level||c<a.level||a.level>5)){j=h.call(j);var k="%s%s",l=[];if(g)b.type(j[0],"string")&&j[0].match(/\%(s|j|d)/g)&&(k+=j.shift()),l.unshift(k,d(a),e(c));else{k="%c%s%c%s%c%s",b.type(j[0],"string")&&j[0].match(/\%(c|s|o|O|d|i|f)/g)&&(k+=j.shift()),f=""===f.replace(/\s+/,"")?"":f+" 	";var m="color:"+_colors[c]+";",n="color:purple",o="color:black";l=[k,n,d(a),m,e(c),o,f]}switch(i.apply(l,j),c){case-1:return;case 0:console.log(arguments[3]);break;case 2:console.log.apply(console,l);break;default:try{console[_levels[c]].apply(console,l)}catch(p){console.log("[Logger (recovery mode)] ",l)}}}}function c(a){var b=a.callee.caller.name;return!b&&this.traceAnonymous?"<anonymous> "+a.callee.caller+"\n":b}function d(a){var b=a.name||"";return j?j.magenta(b):b}function e(a){return f(a," "+_levels[a].toUpperCase()+" ")+f(6,"["+(new Date).toLocaleTimeString()+"] ")}function f(a,b){return j?j[_colors[a]](b):b}var g="object"==typeof exports,h=Array.prototype.slice,i=Array.prototype.push,j=g?require("chalk"):null;return _levels=["dummy","trace","debug","info","warn","error"],_colors=["gray","gray","green",g?"cyan":"blue",g?"yellow":"darkorange","red","gray"],{log:function(){a(this,0,c(arguments),arguments)},trace:function(){a(this,1,c(arguments),arguments)},debug:function(){a(this,2,c(arguments),arguments)},info:function(){a(this,3,c(arguments),arguments)},warn:function(){a(this,4,c(arguments),arguments)},error:function(){a(this,5,c(arguments),arguments)}}}(),a.idGen=(a.idGen||0)+1,b.inherit(b.Handler,a,function(){function a(a){if(void 0!==a&&("string"===b.toType(a)&&(a=[a,""]),"regexp"!==b.toType(a[0]))){var c=a[2];a[0]=void 0!==c?new RegExp(a[0],c):new RegExp(a[0],"g")}}var c,d=!1;return{initElements:function(a){var c,d,e=this;"string"===b.toType(e.$els)&&"auto"===e.$els.toLowerCase()?(e.$els=[],c=a):c=e.$els;for(d in c)c.hasOwnProperty(d)&&(e.$els[d]=b.select(c[d],e.$container))},initAudio:function(){this.audio=new Audio,this.audio.preload="auto";var a=this.getFileType(),b=this.audio.canPlayType("audio/"+a);"probably"===b||"maybe"===b?(this.setSource(),this.audio.volume=.8):console.log("This browser does not support "+a+" playback.")},updateCurrent:function(){var c=this;if("null"!==c.libType&&"undefined"!==c.libType){if("string"===c.libType){if(b.endsWith(c.lib.toLowerCase(),".json")){if(b.getJSON(c.lib,function(a){c.lib=JSON.parse(a)},!1),"undefined"!==c.lib.data&&"array"===b.toType(c.lib.data))return c.lib=c.lib.data,c.libType=b.toType(c.lib),c.albumCount=c.lib.length,void c.updateCurrent();if(c.libType=b.toType(c.lib),"object"===c.libType)return c.albumCount=b.propCount(c.lib),void c.updateCurrent()}c.files=[c.lib],c.trackTitles=[c.lib],c.trackIndex=0,c.albumIndex=0,c.startingTrackIndex=0,c.startingAlbumIndex=0}else{if("object"!==c.libType&&"array"!==c.libType)throw new TypeError("Lap.lib must be a string, object, or array. See "+c.doc+"tutorial-lib.html");var d="array"===c.libType?c.lib[c.albumIndex]:c.lib;c.artist=d.artist,c.album=d.album,c.files=d.files,c.cover=d.cover,c.trackTitles=d.trackTitles,c.replacement=d.replacement}a(c.replacement),c.trackCount="string"===b.toType(c.files)?1:c.files.length,c.matchTrackTitles()}},matchTrackTitles:function(){var a,c=this;if(void 0===c.trackTitles||c.trackCount>c.trackTitles.length)for(c.trackTitles=[],a=0;a<c.trackCount;a++)c.trackTitles[a]=b.sliceRel(c.files[a].replace("."+c.getFileType(),"")),void 0!==c.replacement&&(c.trackTitles[a]=c.trackTitles[a].replace(c.replacement[0],c.replacement[1]))},setSource:function(){var a=this.audio;a.src=this.files[this.trackIndex]},addListeners:function(){function a(a){null!==a&&(a.addEventListener("mousedown",function(a){d=!0,b.hasClass(a.target,"lap-seek-forward")?e.seekForward():e.seekBackward()}),a.addEventListener("mouseup",function(){d=!1,clearTimeout(c)}))}var e=this,f=e.$els,g=this.audio;g.addEventListener("progress",function(){b.html(f.buffered,e.bufferFormatted())}),g.addEventListener("timeupdate",function(){b.html(f.currentTime,e.currentTimeFormatted())}),g.addEventListener("durationchange",function(){b.html(f.duration,e.durationFormatted())}),g.addEventListener("volumechange",function(){b.html(f.volumeRead,e.volumeFormatted())}),g.addEventListener("ended",function(){e.next(),e.audio.paused&&e.audio.play()}),e.registerClick(f.playPause,e.togglePlay),e.registerClick(f.prev,e.prev),e.registerClick(f.next,e.next),e.registerClick(f.volumeUp,e.incVolume),e.registerClick(f.volumeDown,e.decVolume),e.registerClick(f.prevAlbum,e.prevAlbum),e.registerClick(f.nextAlbum,e.nextAlbum),e.$container.addEventListener("click",function(a){if(b.hasClass("lap-playlist-item",a.target)){var c=!e.audio.paused;e.trackIndex=parseInt(a.target.getAttribute("lap-data-index")),e.setSource(),e.executeHandler("trackChange"),c&&e.audio.play()}}),a(f.seekForward),a(f.seekBackward),this.on("load",function(){e.updateTrackTitleEl(),e.updateTrackNumberEl(),e.updateArtistEl(),e.updateAlbumEl(),e.updateCover(),e.populatePlaylist(),b.addClass(f.playPause,"lap-paused")}).on("play",function(){b.removeClass(f.playPause,"lap-paused").addClass(f.playPause,"lap-playing")}).on("pause",function(){b.removeClass(f.playPause,"lap-playing").addClass(f.playPause,"lap-paused")}).on("trackChange",function(){e.updateTrackTitleEl(),e.updateTrackNumberEl(),e.updateCurrentPlaylistItem()}).on("albumChange",function(){e.updateTrackTitleEl(),e.updateTrackNumberEl(),e.updateArtistEl(),e.updateAlbumEl(),e.updateCover(),e.populatePlaylist()})},initPlugins:function(){if(this.settings.plugins){this.plugins=this.plugins||{};for(var a,c,d=this,e=d.settings.plugins,f=[],g=e.length,h=0;g>h;h++)a=e[h],a.ctor&&(c=a.name?a.name:a.ctor+"_"+Date.now(),d.plugins[c]=a.args?b.construct(a.ctor,f.concat(d,a.args)):b.construct(a.ctor),d.plugins[c].init(),logger.debug("plugin registered -> lap.plugins[%i]: %s",h,c));return this}},registerClick:function(a,b){var c=this;return a?(a.addEventListener("click",function(){b.call(c)}),c):c},load:function(){return this.executeHandler("load"),this},updateTrackTitleEl:function(){return b.html(this.$els.trackTitle,this.trackTitles[this.trackIndex]),this},updateTrackNumberEl:function(){return b.html(this.$els.trackNumber,this.trackIndex+1),this},updateArtistEl:function(){return b.html(this.$els.artist,this.artist),this},updateAlbumEl:function(){return b.html(this.$els.albumTitle,this.album),this},updateCover:function(){return null!==this.$els.cover&&(this.$els.cover.src=this.cover),this},togglePlay:function(){var a=this;return a.audio.paused?a.play():a.pause(),a.executeHandler("togglePlay"),a},play:function(){return this.audio.play(),this.executeHandler("play"),this},pause:function(){return this.audio.pause(),this.executeHandler("pause"),this},setTrack:function(a){return this.trackIndex=0>=a?0:a>=this.trackCount?this.trackCount-1:a,this.executeHandler("trackChange"),this},populatePlaylist:function(){var a=this,c=0,d="";for(b.html(a.$els.playlistPanel,""),c=0;c<a.trackCount;c++)d+=b.format("<div>{0}{1}{2}</div>",a.settings.prependTrackNumbers?'<span class="lap-playlist-track-number">'+a.trackNumberFormatted(c+1)+"</span>":"",'<span class="lap-playlist-item'+(c===a.trackIndex?" lap-current":"")+'" lap-data-index="'+c+'">',a.trackTitles[c].trim()+"</span>");b.append(a.$els.playlistPanel,d)},playlistFormatted:function(){for(var a=this,b=[],c=0;c<a.trackCount;c++)b[c]=a.settings.prependTrackNumbers?a.trackNumberFormatted(c+1):"",b[c]+=a.trackTitles[c];return b},property:function(a){if("object"===this.libType&&this.lib.hasOwnProperty(a))return this.lib[a];if("array"===this.libType){for(var b=[],c=this.lib.length,d=0;c>d;d++)this.lib[d].hasOwnProperty(a)&&(b[d]=this.lib[d][a]);return b}},trackNumberFormatted:function(a){var c=(this.trackCount+"").length-(a+"").length;return b.repeat("0",c)+a+this.settings.trackNumberPostfix},updateCurrentPlaylistItem:function(){for(var a=this,c=b.selectAll(".lap-playlist-item",a.$container),d=c.length,e=0;d>e;e++)if(c[e].getAttribute("lap-data-index")==a.trackIndex)return b.removeClass(c,"lap-current"),b.addClass(c[e],"lap-current"),a;return a},prev:function(){var a=this,b=!a.audio.paused;return a.trackIndex=a.trackIndex-1<0?a.trackCount-1:a.trackIndex-1,a.setSource(),b&&a.audio.play(),this.executeHandler("trackChange"),this},next:function(){var a=this,b=!a.audio.paused;return a.trackIndex=a.trackIndex+1>=a.trackCount?0:a.trackIndex+1,a.setSource(),b&&a.audio.play(),this.executeHandler("trackChange"),this},trackChange:function(){this.executeHandler("trackChange")},prevAlbum:function(){var a=this,b=!a.audio.paused;return a.albumIndex=a.albumIndex-1<0?a.albumCount-1:a.albumIndex-1,a.updateCurrent(),a.trackIndex=0,a.setSource(),b&&a.audio.play(),this.executeHandler("albumChange"),this},nextAlbum:function(){var a=this,b=!a.audio.paused;return a.albumIndex=a.albumIndex+1>a.albumCount-1?0:a.albumIndex+1,a.updateCurrent(),a.trackIndex=0,a.setSource(),b&&a.audio.play(),this.executeHandler("albumChange"),this},incVolume:function(){return this.setVolume(!0),this},decVolume:function(){return this.setVolume(!1),this},setVolume:function(a){var b=this.audio.volume,c=this.settings.volumeInterval;return this.audio.volume=a?b+c>=1?1:b+c:0>=b-c?0:b-c,this.executeHandler("volumeChange"),this},seekBackward:function(){if(d){var a=this;return c=setInterval(function(){a.seek(!1)},a.settings.seekTime),this}},seekForward:function(){if(d){var a=this;return c=setInterval(function(){a.seek(!0)},a.settings.seekTime),this}},seek:function(a){var b,c=this;return a?(b=c.audio.currentTime+c.settings.seekInterval,c.audio.currentTime=b>=c.audio.duration?c.audio.duration:b):(b=c.audio.currentTime+-1*c.settings.seekInterval,c.audio.currentTime=0>=b?0:b),this.executeHandler("seek"),this},seekFromSeekbar:function(a){var b=this,c=b.$els.seekbar,d=c.getBoundingClientRect(),e=a.clientX-d.left;return b.audio.currentTime=e/d.width*b.audio.duration,b.executeHandler("seek"),this},getFileType:function(){var a;return"string"===this.libType?a=this.lib:"object"===this.libType?a=1===this.trackCount?this.lib.files:this.lib.files[this.trackIndex]:"array"===this.libType&&(a=1===this.trackCount?this.lib[this.albumIndex].files:this.lib[this.albumIndex].files[this.trackIndex]),void 0===a?'"unknown filetype"':a.slice(a.length-3)},bufferFormatted:function(){if(!this.audio)return 0;var a,c=this.audio;try{a=c.buffered.end(c.buffered.length-1)}catch(d){return 0}var e=Math.round(b.scale(a,0,c.duration,0,100));return isNaN(e)?0:e},currentTimeFormatted:function(){var a=b.formatTime(Math.floor(this.audio.currentTime.toFixed(1)));return this.audio.duration<3600?a.slice(3):a},durationFormatted:function(){var a=b.formatTime(Math.floor(this.audio.duration.toFixed(1)));return this.audio.duration<3600?a.slice(3):a},volumeFormatted:function(){return Math.round(100*this.audio.volume)},getTooly:function(){return b},toString:function(){return Object.getOwnPropertyNames(this)}}}()),a});