/*! lap v0.3.0 | Â© 2015 Joshua Kleckner | http://lokua.net/license-mit.html */
!function(){"use strict";angular.module("lnet.lap",["tooly"])}(),angular.module("lnet.lap").run(["$templateCache",function(a){"use strict";a.put("lap-controls.html",'<div class="lap lap__player"><div class="lap__details"><div><span class="lap__detail lap__artist"></span><span class="lap__detail lap__album"></span></div><div><span class="lap__detail lap__track-number"></span><span class="lap__detail lap__track-title"></span></div></div><br/><div class="lap__controls"><div class="lap__control lap__speaker__container"><i class="lap__speaker lap-i-volume-high"></i></div><lap-canvas-volume-range lap-volume-range-revealer="vRangeReady" class="lap__canvas-volume-range lap--hidden"></lap-canvas-volume-range><div class="lap__control lap__non-v"><i class="lap__play-pause lap-i-play"></i></div><div data-lap-tooltip="previous track" class="lap__control lap__tooltip lap__non-v"><i class="lap__prev lap-i-prev"></i></div><div data-lap-tooltip="next track" class="lap__control lap__tooltip lap__non-v"><i class="lap__next lap-i-next"></i></div><div class="lap__read lap__non-v lap__current-time">00:00</div><lap-canvas-prog-seek ready="ready" class="lap__control lap__prog-seek lap__non-v"></lap-canvas-prog-seek><div class="lap__read lap__duration lap__non-v">00:00</div><div data-lap-tooltip="previous album" class="lap__control lap__tooltip lap__non-v"><i class="lap__prev-album lap-i-prev-album"></i></div><div data-lap-tooltip="show albums" class="lap__control lap__tooltip lap__non-v"><i ng-class="{active:discogActive}" ng-click="discogActive=!discogActive" class="lap__discog lap-i-discog"></i></div><div data-lap-tooltip="next album" class="lap__control lap__tooltip lap__non-v"><i class="lap__next-album lap-i-next-album"></i></div></div></div>'),a.put("lap-discog.html",'<div class="lap__discog__panel"><div ng-repeat="album in lib" ng-click="loadAlbum($index)" ng-class="{active:$index===lap.albumIndex}" class="lap__discog__item"><img ng-src="{{album.cover}}"/><aside>{{album.album}}</aside></div></div>'),a.put("lap-playlist.html",'<div class="lap__cover__container"><img ng-src="{{cover}}" class="lap__cover"/></div><div ng-show="showPlayist" class="lap__playlist__panel"><div class="lap__playlist__panel__inner"><div ng-repeat="track in tracklist" ng-class="{ &quot;lap__playlist__item--current&quot;: $index === lap.trackIndex }" ng-click="setTrack($index)" class="lap__playlist__item"><span class="lap__playlist__track-number">{{trackNumbers[$index]}} &nbsp;</span><span class="lap__playlist__track-title">{{track}}</span></div></div></div>')}]),function(){"use strict";function a(a,b,c,d,e){function f(a,b,c,e){return d.Handler.call(this),this.id=++g,this.element=a,this.container=a[0],this.settings=angular.extend({},this.defaultSettings,c),this.lib=b,e||this.initialize(),h.push(this),this}var g=g||0,h=[],i=/mp3|wav|ogg|aiff/i;return f.getInstance=function(a){var c=b.defer();return c.resolve(h[a]),c.promise},f.getLib=function(c){var e=b.defer();return"object"===d.type(c)?(e.resolve([c]),e.promise):"array"===d.type(c)?(e.resolve(c),e.promise):i.test(c)?(e.resolve([{files:c}]),e.promise):a.get(c).then(function(a){return e.resolve(a.data),e.promise},function(a){return e.reject(a)})},f.PluginConstructorError=function(a){Error.call(this)},f.PluginConstructorError.prototype=Error,f.prototype=new d.Handler,f.prototype.defaultSettings={callbacks:{},discogPlaylistExclusive:!0,plugins:[],prependTrackNumbers:!0,replacementText:void 0,startingAlbumIndex:0,startingTrackIndex:0,seekInterval:5,seekTime:250,selectors:{},selectorPrefix:"lap",trackNumberPostfix:" - ",useNativeProgress:!1,useNativeSeekRange:!1,useNativeVolumeRange:!1,volumeInterval:.05},f.prototype.selectors={state:{playlistItemCurrent:"lap__playlist__item--current",playing:"lap--playing",paused:"lap--paused",hidden:"lap--hidden"},album:"lap__album",artist:"lap__artist",buffered:"lap__buffered",cover:"lap__cover",currentTime:"lap__current-time",discog:"lap__discog",discogItem:"lap__discog__item",discogPanel:"lap__discog__panel",duration:"lap__duration",info:"lap__info",infoPanel:"lap__info-panel",next:"lap__next",nextAlbum:"lap__next-album",playPause:"lap__play-pause",playlist:"lap__playlist",playlistItem:"lap__playlist__item",playlistPanel:"lap__playlist__panel",playlistTrackNumber:"lap__playlist__track-number",playlistTrackTitle:"lap__playlist__track-title",prev:"lap__prev",prevAlbum:"lap__prev-album",progress:"lap__progress",seekBackward:"lap__seek-backward",seekForward:"lap__seek-forward",seekRange:"lap__seek-range",trackNumber:"lap__track-number",trackTitle:"lap__track-title",volumeButton:"lap__volume-button",volumeDown:"lap__volume-down",volumeRead:"lap__volume-read",volumeRange:"lap__volume-range",volumeUp:"lap__volume-up"},f.prototype.SEEKING=!1,f.prototype.VOLUME_CHANGING=!1,f.prototype.MOUSEDOWN_TIMER=0,f.prototype.initialize=function(){this.plugins={},this.playlistPopulated=!1,this.albumIndex=this.settings.startingAlbumIndex,this.albumCount=this.lib.length,this.update(),this.initAudio(),this.initElements(),this.addAudioListeners(),this.addVolumeListeners(),this.addSeekListeners(),this.addListeners(),this.register(this.settings.callbacks),c.$broadcast("lnet.lap.instanceInitialized",this),this.trigger("load")},f.prototype.update=function(){var a=this,b=a.lib,c=b[a.albumIndex];if(a.trackIndex=a.settings.startingTrackIndex,a.playlistPopulated=!1,["artist","album","files","cover","tracklist","replacement"].forEach(function(b){a[b]=c[b]}),a.trackCount=a.files.length,void 0!==a.replacement){var e=a.replacement;if("string"===d.type(e)&&(e=[e,""]),"regexp"!==d.type(e[0])){var f=e[2];e[0]=new RegExp(e[0],void 0!==f?f:"g")}}return a.formatTracklist(),a},f.prototype.initAudio=function(){this.audio=new Audio,this.audio.preload="auto";var a=this.getFileType(),b=this.audio.canPlayType("audio/"+a);"probably"===b||"maybe"===b?(this.setSource(),this.audio.volume=.8):console.warn("This browser does not support "+a+" playback.")},f.prototype.setSource=function(){this.audio.src=this.files[this.trackIndex]},f.prototype.getFileType=function(){return d.extension(this.files[this.trackIndex])},f.prototype.initElements=function(){var a=this;a.els={},a.selectors=angular.extend({},a.selectors,a.settings.selectors),d.each(a.selectors,function(b,c){if("object"!==d.type(b)){var f=e.element("."+b,a.element);f.length&&(a.els[c]=f)}})},f.prototype.addAudioListeners=function(){var a=this,b=a.audio,c=a.els;return(c.buffered||a.settings.useNativeProgress&&c.progress)&&b.addEventListener("progress",function(){var b=+a.bufferFormatted();c.buffered&&c.buffered.html(b),nativeProgress&&(c.progress[0].value=b)}),c.currentTime&&b.addEventListener("timeupdate",function(){c.currentTime.html(a.currentTimeFormatted())}),c.duration&&b.addEventListener("durationchange",function(){c.duration.html(a.durationFormatted())}),c.volumeRead&&b.addEventListener("volumechange",function(){c.volumeRead.html(a.volumeFormatted())}),b.addEventListener("ended",function(){a.next(),a.audio.paused&&a.audio.play()}),a},f.prototype.addListeners=function(){var a=this,b=a.els;b.playPause&&b.playPause.on("click",function(){a.togglePlay()}),b.prev&&b.prev.on("click",function(){a.prev()}),b.next&&b.next.on("click",function(){a.next()}),b.volumeUp&&b.volumeUp.on("click",function(){a.incVolume()}),b.volumeDown&&b.volumeDown.on("click",function(){a.decVolume()}),b.prevAlbum&&b.prevAlbum.on("click",function(){a.prevAlbum()}),b.nextAlbum&&b.nextAlbum.on("click",function(){a.nextAlbum()}),b.discog&&b.discog.on("click",function(){a.trigger("discogClick")}),a.on("load",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.artist&&a.updateArtistEl(),b.album&&a.updateAlbumEl(),b.cover&&a.updateCover(),b.playPause&&(b.playPause.addClass(a.selectors.state.paused),a.on("play",function(){b.playPause.removeClass(a.selectors.state.paused).addClass(a.selectors.state.playing)}).on("pause",function(){b.playPause.removeClass(a.selectors.state.playing).addClass(a.selectors.state.paused)}))}).on("trackChange",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.currentTime&&b.currentTime.html(a.currentTimeFormatted()),b.duration&&b.duration.html(a.durationFormatted())}).on("albumChange",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.artist&&a.updateArtistEl(),b.album&&a.updateAlbumEl(),b.cover&&a.updateCover()})},f.prototype.addSeekListeners=function(){var a=this,b=a.els,c=a.audio,e=b.seekRange,f=a.settings.useNativeSeekRange&&e&&e.els.length>0;f?(c.addEventListener("timeupdate",function(b){a.SEEKING||(e.get(0).value=d.scale(c.currentTime,0,c.duration,0,100))}),e.on("mousedown",function(b){a.SEEKING=!0}).on("mouseup",function(b){var f=e.get(0);f.value||a.logger.debug("what the fuck! "+f),c.currentTime=d.scale(f.value,0,f.max,0,c.duration),a.trigger("seek"),a.SEEKING=!1})):[b.seekForward,b.seekBackward].forEach(function(b){b&&b.on("mousedown",function(b){a.SEEKING=!0,angular.element(b.target).hasClass(a.selectors.seekForward)?a.seekForward():a.seekBackward()}).on("mouseup",function(b){a.SEEKING=!1,clearTimeout(a.MOUSEDOWN_TIMER)})})},f.prototype.addVolumeListeners=function(){var a=this,b=a.els,c=a.audio,d=b.volumeRange;a.settings.useNativeVolumeRange&&d&&d.els.length>0&&(c.addEventListener("volumechange",function(){a.VOLUME_CHANGING||(d.get(0).value=a.volumeFormatted())}),d.on("mousedown",function(){a.VOLUME_CHANGING=!0}).on("mouseup",function(){c.volume=.01*d.get(0).value,a.trigger("volumeChange"),a.VOLUME_CHANGING=!1}))},f.prototype.registerPlugin=function(a,b){this.plugins[a]=b},f.prototype.updateTrackTitleEl=function(){return this.els.trackTitle.html(this.tracklist[this.trackIndex]),this},f.prototype.updateTrackNumberEl=function(){return this.els.trackNumber.html(+this.trackIndex+1),this},f.prototype.updateArtistEl=function(){return this.els.artist.html(this.artist),this},f.prototype.updateAlbumEl=function(){return this.els.album.html(this.album),this},f.prototype.updateCover=function(){return this.els.cover.get(0).src=this.cover,this},f.prototype.togglePlay=function(){return this.audio.paused?this.play():this.pause(),this.trigger("togglePlay"),this},f.prototype.play=function(){return this.audio.play(),this.trigger("play"),this},f.prototype.pause=function(){return this.audio.pause(),this.trigger("pause"),this},f.prototype.setTrack=function(a){0>=a?this.trackIndex=0:a>=this.trackCount?this.trackIndex=this.trackCount-1:this.trackIndex=a;var b=!this.audio.paused;return this.setSource(),b&&this.audio.play(),this.trigger("trackChange"),this},f.prototype.prev=function(){var a=!this.audio.paused;return this.trackIndex=this.trackIndex-1<0?this.trackCount-1:this.trackIndex-1,this.setSource(),a&&this.audio.play(),this.trigger("trackChange"),this},f.prototype.next=function(){var a=!this.audio.paused;return this.trackIndex=this.trackIndex+1>=this.trackCount?0:this.trackIndex+1,this.setSource(),a&&this.audio.play(),this.trigger("trackChange"),this},f.prototype.prevAlbum=function(){var a=!this.audio.paused;return this.albumIndex=this.albumIndex-1<0?this.albumCount-1:this.albumIndex-1,this.update(),this.trackIndex=0,this.setSource(),a&&this.audio.play(),this.trigger("albumChange"),this},f.prototype.nextAlbum=function(){var a=!this.audio.paused;return this.albumIndex=this.albumIndex+1>this.albumCount-1?0:this.albumIndex+1,this.update(),this.trackIndex=0,this.setSource(),a&&this.audio.play(),this.trigger("albumChange"),this},f.prototype.setAlbum=function(a){return 0>=a?this.albumIndex=0:a>=this.albumCount?this.albumIndex=this.albumCount-1:this.albumIndex=a,this.update(),this.setTrack(this.lib[this.albumIndex].startingTrackIndex||0),this.trigger("albumChange"),this},f.prototype.incVolume=function(){return this.setVolume(!0),this},f.prototype.decVolume=function(){return this.setVolume(!1),this},f.prototype.setVolume=function(a){var b=this.audio.volume,c=this.settings.volumeInterval;return a?this.audio.volume=b+c>=1?1:b+c:this.audio.volume=0>=b-c?0:b-c,this.trigger("volumeChange"),this},f.prototype.seekBackward=function(){if(!this.SEEKING)return this;var a=this;return this.MOUSEDOWN_TIMER=setInterval(function(){a.seek(a,!1)},a.settings.seekTime),a},f.prototype.seekForward=function(){if(!this.SEEKING)return this;var a=this;return this.MOUSEDOWN_TIMER=setInterval(function(){a.seek(a,!0)},a.settings.seekTime),a},f.prototype.formatTracklist=function(){if(d.truthy(this.tracklist))return this;for(var a=this,b=a.replacement,c=[],e=0;e<a.trackCount;e++)c[e]=d.sliceRel(d.stripExtension(a.files[e])),d.truthy(b)&&(c[e]=c[e].replace(b[0],b[1])),c[e]=c[e].trim();return a.tracklist=c,a},f.prototype.bufferFormatted=function(){if(!this.audio)return 0;var a,b=this.audio;try{a=b.buffered.end(b.buffered.length-1)}catch(c){return 0}var e=Math.round(d.scale(a,0,b.duration,0,100));return isNaN(e)?0:e},f.prototype.currentTimeFormatted=function(){if(isNaN(this.audio.duration))return"00:00";var a=d.formatTime(Math.floor(this.audio.currentTime.toFixed(1)));return this.audio.duration<3600||"00:00:00"===a?a.slice(3):a},f.prototype.durationFormatted=function(){if(isNaN(this.audio.duration))return"00:00";var a=d.formatTime(Math.floor(this.audio.duration.toFixed(1)));return this.audio.duration<3600||"00:00:00"===a?a.slice(3):a},f.prototype.volumeFormatted=function(){return Math.round(100*this.audio.volume)},f.prototype.trackNumberFormatted=function(a){var b=(""+this.trackCount).length-(""+a).length;return d.repeat("0",b)+a+this.settings.trackNumberPostfix},f}angular.module("lnet.lap").factory("Lap",a),a.$inject=["$http","$q","$rootScope","tooly","lapUtil"]}(),function(){"use strict";function a(a){function b(a){return a&&(1===a.nodeType||9===a.nodeType)}function c(a,c,d){var e;return e=d?(b(d)?d:d[0])[a](c):document[a](c),angular.element(e)}var d;return{safeApply:function(a){var b=a.$root.$$phase;"$apply"!==b&&"$digest"!==b&&a.$apply()},body:function(){return d||(d=this.element("body")),d},isNode:function(a){return b(a)},element:function(a,b){return c("querySelector",a,b)},elementAll:function(a,b){return c("querySelectorAll",a,b)}}}angular.module("lnet.lap").factory("lapUtil",a),a.$inject=["tooly"]}(),function(){"use strict";function a(a,b,c){return b.CanvasProgSeek=function(c,d,e){var f=this;if(f.lap=c,f.element=angular.element(d.children()[0]),!f.element.length)throw new b.PluginConstructorError("unable to find Lap.CanvasProgSeek element");f.element.append(a.tag("canvas.lap__prog-seek__track")).append(a.tag("canvas.lap__prog-seek__progress")).append(a.tag("canvas.lap__prog-seek__knob")),f.track=f.element[0].querySelector(".lap__prog-seek__track"),f.progress=f.element[0].querySelector(".lap__prog-seek__progress"),f.knob=f.element[0].querySelector(".lap__prog-seek__knob");var g=function(a){if(!f[a])throw new b.PluginConstructorError("unable to find "+a+" element")};g("track"),g("progress"),g("knob"),f.trackCtx=f.track.getContext("2d"),f.progressCtx=f.progress.getContext("2d"),f.knobCtx=f.knob.getContext("2d");var h=16;return f.settings=angular.extend({},{track:{fill:"#bbb",stroke:null,height:h},progress:{fill:"#999",stroke:null,height:h},knob:{fill:"#000",stroke:null,height:h,width:4},lineWidth:2,width:f.track.width||100,height:f.track.height||16,padding:0},e),f},b.CanvasProgSeek.prototype.init=function(){var b,d=this,e=d.settings,f=d.lap.audio,g=!1;return d.track.width=d.progress.width=d.knob.width=e.width,d.track.height=d.progress.height=d.knob.height=e.height,d.element.attr("height",d.settings.height),d.drawTrack(),d.drawProgress(),d.drawKnob(0),f.addEventListener("progress",function(){g||d.drawProgress()}),f.addEventListener("timeupdate",function(){g||d.drawKnob()}),d.element.on("mousedown",function(a){g=!0}).on("mousemove",function(c){g&&(d.drawKnob(c.offsetX),b=a.scale(c.offsetX,0,e.width-e.knob.width,0,1),b>=f.duration&&(b=f.duration),f.currentTime=b)}),c.body().on("mouseup",function(b){g&&(f.currentTime=a.scale(b.offsetX,0,e.width,0,f.duration),g=!1)}),d.lap.registerPlugin("CanvasProgSeek",d),d},b.CanvasProgSeek.prototype.drawTrack=function(){var a=this,b=a.trackCtx,c=a.track,d=a.settings,e=[],f=0;b.clearRect(0,0,d.width,d.height),b.fillStyle=d.track.fill,d.track.height<d.knob.height&&(f=(d.knob.height-d.track.height)/2),e=[0,f,c.width,d.track.height],b.fillRect.apply(b,e),d.track.stroke&&(b.strokeStyle=d.track.stroke,b.strokeRect.apply(b,e))},b.CanvasProgSeek.prototype.drawProgress=function(){var b=this,c=b.lap,d=b.settings,e=b.progressCtx,f=b.progress,g=[],h=0,i=c.bufferFormatted();return e.clearRect(0,0,d.width,d.height),e.fillStyle=d.progress.fill,d.progress.height<d.knob.height&&(h=(d.knob.height-d.progress.height)/2),g=[0,h,a.scale(i,0,100,0,f.width),d.progress.height],e.fillRect.apply(e,g),d.progress.stroke&&(e.strokeStyle=d.progress.stroke,e.strokeRect.apply(e,g)),this},b.CanvasProgSeek.prototype.drawKnob=function(b){var c=this,d=c.settings,e=c.knobCtx,f=c.knob,g=c.lap.audio,h=[],i=void 0!==b?b:g.currentTime;return e.lineWidth=d.lineWidth,e.clearRect(0,0,d.width,d.height),e.fillStyle=d.knob.fill,void 0!==b?(b>=f.width-c.settings.knob.width&&(b=f.width-c.settings.knob.width),i=b):i=g.currentTime,h=[void 0!==b?b:a.scale(i,0,g.duration,0,f.width),0,d.knob.width,d.knob.height],e.fillRect.apply(e,h),d.knob.stroke&&(e.strokeStyle=d.knob.stroke,e.strokeRect.apply(e,h)),this},{restrict:"E",template:'<div class="lap__prog-seek"></div>',link:function(a,c,d){var e,f="#555",g="#a7a7a7",h={width:76,height:18,track:{fill:g,height:2},progress:{fill:f,height:2},knob:{fill:f,height:12,width:6}},i=a.$watch("ready",function(d,f){d&&(e=new b.CanvasProgSeek(a.lap,c,h),e.init(),i())})}}}angular.module("lnet.lap").directive("lapCanvasProgSeek",a),a.$inject=["tooly","Lap","lapUtil"]}(),function(){"use strict";function a(a,b,c){var d=!1;return b.CanvasVolumeRange=function(c,d,e){var f=this;if(f.lap=c,f.element=angular.element(d.children()[0]),!f.element.length)throw new b.PluginConstructorError("unable to find Lap.VolumeRange element");if(f.element.append(a.tag("canvas.lap__canvas-volume-range__track")).append(a.tag("canvas.lap__canvas-volume-range__knob")),f.track=f.element[0].querySelector(".lap__canvas-volume-range__track"),f.knob=f.element[0].querySelector(".lap__canvas-volume-range__knob"),!f.track)throw new b.PluginConstructorError("unable to find track element");if(!f.knob)throw new b.PluginConstructorError("unable to find knob element");return f.trackCtx=f.track.getContext("2d"),f.knobCtx=f.knob.getContext("2d"),f.settings=angular.extend({},{trackColor:"#a7a7a7",trackHeight:2,knobColor:"#555",knobWidth:6,knobHeight:12,width:76,height:16},e),f},b.CanvasVolumeRange.prototype.init=function(){var b,e=this,f=e.settings,g=e.lap.audio;return e.track.width=e.knob.width=f.width,e.track.height=e.knob.height=f.height,e.element.attr("height",e.settings.height),e.drawTrack(),e.drawKnob(a.scale(g.volume,0,1,0,f.width)),e.element.on("mousedown",function(a){d=!0}).on("mousemove",function(c){d&&(e.drawKnob(c.offsetX),b=a.scale(c.offsetX,0,f.width-f.knobWidth,0,1),b>=.95&&(b=1),0>b&&(b=0),g.volume=b,e.lap.trigger("volumeChange"))}),c.body().on("mouseup",function(a){d&&(d=!1)}),e.lap.registerPlugin("CanvasVolumeRange",e),e},b.CanvasVolumeRange.prototype.drawTrack=function(){var a=this,b=a.trackCtx,c=a.track,d=a.settings,e=[],f=0;return b.clearRect(0,0,d.width,d.height),b.fillStyle=d.trackColor,d.trackHeight<d.knobHeight&&(f=(d.knobHeight-d.trackHeight)/2),e=[0,f,c.width,d.trackHeight],b.fillRect.apply(b,e),d.trackStroke&&(b.strokeStyle=d.trackStroke,b.strokeRect.apply(b,e)),a},b.CanvasVolumeRange.prototype.drawKnob=function(b){var c,d=this,e=d.settings,f=d.knobCtx,g=d.knob,h=d.lap.audio,i=[];return f.clearRect(0,0,e.width,e.height),f.fillStyle=e.knobColor,void 0!==b?(b>=g.width-d.settings.knobWidth&&(b=g.width-d.settings.knobWidth),c=b):c=h.volume,i=[void 0!==b?b:a.scale(c,0,1,0,g.width),0,e.knobWidth,e.knobHeight],f.fillRect.apply(f,i),e.knobStroke&&(f.strokeStyle=e.knobStroke,f.strokeRect.apply(f,i)),d},{restrict:"E",template:'<div class="lap__canvas-volume-range lap__volume-range"></div>',link:function(a,c,d){var e,f={width:76,height:18},g=a.$watch("ready",function(d,h){d&&(e=new b.CanvasVolumeRange(a.lap,c,f),e.init(),a.vRangeReady=!0,g())})}}}angular.module("lnet.lap").directive("lapCanvasVolumeRange",a),a.$inject=["tooly","Lap","lapUtil"]}(),function(){"use strict";function a(a,b,c){return{restrict:"E",scope:{src:"@"},template:a.get("lap-controls.html"),link:function(a,b,d){return a.ready=!1,a.player=a,a.discogActive=!1,d.hasOwnProperty("src")?void a.$watch("src",function(d){var e=d.charAt(0);("["===e||"{"===e)&&(d=a.$eval(d)),c.getLib(d).then(function(d){a.lap=new c(b,d,{discogPlaylistExclusive:!0,plugins:[],prependTrackNumbers:!0,replacementText:void 0,startingAlbumIndex:0,startingTrackIndex:0,seekInterval:5,seekTime:250,selectors:{},selectorPrefix:"lap",trackNumberPostfix:" - ",useNativeProgress:!1,useNativeSeekRange:!1,useNativeVolumeRange:!1,volumeInterval:.05,callbacks:{load:function(){a.ready=!0}}},!1,!0)})}):console.warn("lap-container needs a src attribute. Exiting.")}}}angular.module("lnet.lap").directive("lapContainer",a),a.$inject=["$templateCache","$parse","Lap"]}(),function(){"use strict";function a(a,b){return{restrict:"E",template:a.get("lap-discog.html"),scope:!0,link:function(a,b,c){function d(){e(),a.showDiscog=!0}function e(){a.lib=f.lib.map(function(a){return{cover:a.cover,album:a.album}})}var f,g=a.$watch("lap",function(a,b){a&&(f=a,logger.debug("watch >> lap: %o",f),d(),g())});a.loadAlbum=function(b){f.setAlbum(b),a.$emit("lnet.lap.discogItemChosen",!0)}}}}angular.module("lnet.lap").directive("lapDiscog",a),a.$inject=["$templateCache","tooly"]}(),function(){"use strict";function a(a,b,c){return{restrict:"E",template:a.get("lap-playlist.html"),scope:!0,link:function(a,d,e){function f(){g(),a.showPlayist=!0,h.on("albumChange",function(){g(),c.safeApply(a)}).on("trackChange",function(){c.safeApply(a)})}function g(){var c=String(h.trackCount).length;a.trackNumbers=h.tracklist.map(function(a,d){return b.lpad(String(d+1),c,"0")}),a.tracklist=h.tracklist,a.cover=h.cover}var h,i=a.$watch("lap",function(a,b){a&&(h=a,logger.debug("watch >> lap: %o",h),f(),i())});a.setTrack=function(a){h.setTrack(a)}}}}angular.module("lnet.lap").directive("lapPlaylist",a),a.$inject=["$templateCache","tooly","lapUtil"]}(),function(a){"use strict";function b(a,b,c,d,e,f){return e.VolumeRangeRevealer=function(a,b){var c=this;return c.lap=a,c.element=b,c},e.VolumeRangeRevealer.prototype.levelClasses=["lap-i-volume-off","lap-i-volume-low","lap-i-volume-mid","lap-i-volume-high","lap-i-volume-max"],e.VolumeRangeRevealer.prototype.init=function(){function a(){i.element.addClass(j.selectors.state.hidden),o.removeClass(j.selectors.state.hidden)}var c,g,h,i=this,j=i.lap,k=angular.element(j.container)[0],l=f.element(".lap__speaker",k),m=(f.element(".lap__speaker__container",k),j.els.volumeRange),n=i.element[0].querySelector(".lap__canvas-volume-range__track").width,o=f.elementAll(".lap__non-v",k);if(!m||!m.length)throw new e.PluginContructorError("Lap.VolumeRangeRevealer cannot init without Lap#els.volumeRange element");m.on("mouseenter",function(){h=!0}).on("mousedown",function(){c=!0}).on("mousemove",function(a){if(c){var b=d.scale(a.offsetX,0,n,0,100),e=0;if(b>0){var f=d.scale(b,0,100,0,i.levelClasses.length-1);e=Math.ceil(f)}logger.debug("rangeWidth: %o, e.offsetX: %o, v: %o, classNum: %o, thiz.levelClasses[classNum]: %o",n,a.offsetX,b,e,i.levelClasses[e]),l.removeClass(i.levelClasses.filter(function(a){return a!==i.levelClasses[e]}).join(" ")).addClass(i.levelClasses[e])}}).on("mouseleave",function(){h=!1,c||a()}),l.on("mouseenter",function(){g||h||(i.element.removeClass(j.selectors.state.hidden),o.addClass(j.selectors.state.hidden),g=!0)}).on("mouseleave",function(c){g=!1,b(function(){g||h||a()},500)}),f.body().on("mouseup",function(){c=!1,h||g||a()}),j.registerPlugin("VolumeRangeRevealer",i)},{restrict:"A",link:function(a,b,c){var d,f=a.$watch("ready",function(c,g){c&&(d=new e.VolumeRangeRevealer(a.lap,b),f(),f=a.$watch("vRangeReady",function(a,b){a&&(d.init(),f())}))})}}}angular.module("lnet.lap").directive("lapVolumeRangeRevealer",b),b.$inject=["$document","$timeout","$interval","tooly","Lap","lapUtil"]}();