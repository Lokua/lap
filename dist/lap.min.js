/*! lap v0.0.6 | Copyright Â© 2014 Joshua Kleckner | http://lokua.net/license-mit.html */
!function(a,b){"function"==typeof define&&define.amd?define("tooly",[],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.tooly=b()}(this,function(){function a(a,b){return a={}.toString.call(a).match(l)[1].toLowerCase(),b?a===b.toLowerCase():a}function b(a,b,c){if(a.forEach&&a.forEach===m.forEach)a.forEach(b,c);else for(var d=Object.keys(a),e=0,f=d.length;f>e;e++)b.call(c,a[d[e]],d[e],a);return a}function c(a){return[].map.call(a,function(a){return a})}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function e(a){return a&&(1===a.nodeType||9===a.nodeType)}function f(b,c){var d;return c&&a(c,"string")&&(d=document.querySelector(c)),(d?d:document).querySelector(b)}function g(b,d){var g=null;return d&&(a(d,"string")?g=f(d):a(d,"nodelist")?g=f(d[0]):e(d)&&(g=d)),c((g?g:document).querySelectorAll(b))}function h(a){return r[a]||(r[a]=new RegExp("\\s*"+a+"\\s*(![\\w\\W])?","g")),r[a]}function i(b,d,f){if(a(f,"string"))h=f;else{var g=a(f),h=e(f)?f.outerHTML:f instanceof o.Frankie?f.els:"array"===g?f:"nodelist"===g?c(f):null;if(a(h,"array"))h=h.map(function(a){return a.outerHTML}).join("");else if(!h)return}d.forEach(function(a){a.insertAdjacentHTML(b?"beforeend":"afterbegin",h)})}var j,k=/\s+/,l=/\s([a-z]+)/i,m=Array.prototype,n=m.slice,o={version:"0.0.5"};o.each=function(a,c,d){return b(a,c,d)};var p,q;o.sort=function(a,b,c){var d,e,f,g,h;return p||(p=/(\d+)|(\D+)/g,q=/\d+/),a.sort(function(a,i){for(d=String(a[b]).toLowerCase().match(p),e=String(i[b]).toLowerCase().match(p),c&&(h=d,d=e,e=h);d.length&&e.length;)if(f=d.shift(),g=e.shift(),q.test(f)||q.test(g)){if(!q.test(f))return 1;if(!q.test(g))return-1;if(f!=g)return f-g}else if(f!=g)return f>g?1:-1;return d.length-e.length})};var r={};o.Frankie=function(a,b){return this instanceof o.Frankie?(this.els=e(a)?[a]:g(a,b),this):new o.Frankie(a,b)},o.Frankie.prototype.addClass=function(a){return this.els.forEach(function(b){if(!b.className)return void(b.className+=" "+a);var c=b.className;b.className+=" "+a.split(k).filter(function(a){return-1===c.indexOf(a)}).join(" ")}),this},o.Frankie.prototype.append=function(a){return i(!0,this.els,a),this},o.Frankie.prototype.attr=function(){var c=arguments.length,d=arguments[0];if(1===c){if(!a(d,"object"))return this.els[0].getAttribute(d);b(d,function(a,b){this.els.forEach(function(c){c.setAttribute(b,a)})})}else{var e=arguments[1];this.els.forEach(function(a){a.setAttribute(d,e)})}return this},o.Frankie.prototype.children=function(){var b=new o.Frankie;return this.els.forEach(function(c){var d=c.children;e(d)?b.els.push(d):"htmlcollection"===a(d)&&[].push.apply(b.els,[].slice.call(d).map(function(a){return a}))}),b},o.Frankie.prototype.css=function(){var c={},d=arguments.length;if(2===d)c[arguments[0]]=arguments[1];else{var e=this.els[0];if(1!==d)return e.style||void 0;if(_0=arguments[0],a(_0,"string"))return e.style[_0]||void 0;c=_0}return this.els.forEach(function(a){b(c,function(b,c){a.style[c]=b})}),this},o.Frankie.prototype.empty=function(){return this.els.forEach(function(a){for(;a.lastChild;)a.removeChild(a.lastChild)}),this},o.Frankie.prototype.eq=function(a){var b=new o.Frankie;return b.els=[this.els[a]],b},o.Frankie.prototype.find=function(a){return new o.Frankie(a,this.els)},o.Frankie.prototype.get=function(a){return this.els[a]},o.Frankie.prototype.hasClass=function(a){var b=h(a);return this.els.some(function(c){return c.className.split(k).some(function(c){return c.match(b)==a})})},o.Frankie.prototype.html=function(a){if(!arguments.length){if(void 0===this.els[0])return;return this.els[0].innerHTML}return this.els.forEach(function(b){b.innerHTML=a}),this},o.Frankie.prototype.on=function(a,b){return this.els.forEach(function(c){c.addEventListener(a,b,!1)}),this},o.Frankie.prototype.parent=function(){var a=new o.Frankie,b={};return a.els=this.els.map(function(a){return a.parentNode}).filter(function(a){return b.hasOwnProperty(a)?!1:b[a]=!0}),a},o.Frankie.prototype.prepend=function(a){return i(!1,this.els,a),this},o.Frankie.prototype.remove=function(b,d){var f,g,h=[],i=this,j=i.els.length;if(g=a(b,"array")?b:e(b)?c(b):g instanceof o.Frankie?b.els:a(b,"string")?new o.Frankie(b,i).els:null,g&&g.forEach(function(a){for(f=0;j>f;f++){var b=i.els[f];if(a.parentNode===b)return void(d?h.push(b.removeChild(a)):b.removeChild(a))}}),d){var k=new Frankie;return k.els=h,k}return i},o.Frankie.prototype.removeClass=function(a){var b="("+a.split(k).join("|")+")";return this.els.forEach(function(a){a.className=a.className.replace(h(b)," ").trim()}),this},o.Frankie.prototype.toggleClass=function(a){for(var b,c=0,d=this.els.length;d>c;c++)b=this.eq(c),b.hasClass(a)?b.removeClass(a):b.addClass(a);return this},o.Frankie.prototype.toString=function(){return JSON.stringify(this)},o.Frankie.prototype.zilch=function(){return 0===this.els.length},o.Handler=function(a){return this instanceof o.Handler?(this.context=a||this,this.handlers=this.context.handlers={},this):new o.Handler(a)},o.Handler.prototype.executeHandler=function(a){for(var b=this.handlers[a]||[],c=0,d=b.length;d>c;c++)b[c].apply(this.context,[]);return this},o.Handler.prototype.on=function(a,b){return void 0===this.handlers[a]&&(this.handlers[a]=[]),this.handlers[a].push(b),this},o.Handler.prototype.registerCallbacks=function(a){var b=this,c={};if(void 0!==a)for(c in a)a.hasOwnProperty(c)&&b.on(c,a[c]);return b},o.Handler.prototype.remove=function(a){void 0!==this.handlers[a]&&(this.handlers[a].length=0)},o.Handler.prototype.removeAll=function(){this.handlers={}},o.Handler.prototype.toString=function(){return"[object Handler]"},o.Handler.prototype.trigger=function(a){return this.executeHandler(a)},o.construct=function(b,c){function d(){return"array"===a(c)?b.apply(this,c):b.call(this,c)}return d.prototype=b.prototype,new d},o.extend=function(a,b){return d(a,b)},o.falsy=function(a){return isFalsy(a)},o.fromPrototype=function(a,b){var c,d=Object.create(a);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},o.inherit=function(a,b,c){b.prototype=new a,b.prototype.constructor=b;for(var d in c)c.hasOwnProperty(d)&&(b.prototype[d]=c[d])},o.isFalsy=function(b){if(void 0==b||0==b)return!0;if(a(b,"string")){var c=b.trim();return""===c||"false"===c||"undefined"===c||"null"===c}},o.isHash=function(b){return a(b,"object")&&b.constructor===Object&&!b.nodeType&&!b.setInterval},o.isTruthy=function(a){return!o.isFalsy(a)},o.scale=function(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d},o.toType=function(b,c){return a(b,c)},o.truthy=function(a){return!o.isFalsy(a)},o.type=function(b,c){return a(b,c)},o.contains=function(a,b,c){return a.indexOf(b,c||0)>-1},o.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},o.extension=function(a){return a.substring(a.lastIndexOf(".")+1)},o.format=function(a){var b=n.call(arguments,1);return j||(j=/\%[ojdifsc]+/gi),a.replace(j,function(a){var c=b.shift();if(void 0!==c){switch(a){case"%o":case"%j":c=JSON.stringify(c);break;case"%d":case"%i":c=0|c;break;case"%f":c=parseFloat(c);break;case"%s":}return c}return a})},o.formatMoney=function(b){var c=a(b,"number")?b:+b;return c.toFixed(2).replace(/./g,function(a,b,c){return!b||"."===a||(c.length-b)%3?a:","+a})};var s=/{(\d+)}/g;o.formatString=function(a){var b=n.call(arguments,1);return a.replace(s,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},o.formatTime=function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=Math.floor(a-3600*b-60*c);return 10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),b+":"+c+":"+d},o.lPad=function(a,b,c){var d=b-a.length;return d>0?o.repeat(c||" ",d)+a:a},o.repeat=function(a,b){for(var c="",d=0;b>d;d++)c+=a;return c},o.rPad=function(a,b,c){var d=b-a.length;return d>0?a+o.repeat(c||" ",d):a},o.sliceRel=function(a,b,c){var d=!1;return"/"===a.slice(-1)&&(d=!0,a=a.slice(0,-1)),a=a.slice(a.lastIndexOf("/")+1),d&&c&&(a+="/"),b&&(a="/"+a),a},o.startsWith=function(a,b){return a.substring(0,b.length)===b},o.stringFormat=function(){return o.formatString.apply(null,arguments)},o.stripExtension=function(a){return a.substring(0,a.lastIndexOf("."))};var t,u;return o.tag=function(a,b,c){t||(t=/(^[a-z]+\d{1})|[^\s]+[a-z]+(-\w+)?=(["'])(?:(?!\3)[^\\]|\\.)*\3|[.#-_a-z][-\w]+/gi,u=/area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr/i);var d,e,f=a.match(t),a=f.shift(),g="",h="",i="";if(f.forEach(function(a){var b=a.charAt(0);"#"===b?h+=a.slice(1)+'"':"."===b?g+=" "+a.slice(1)+" ":i+=" "+a}),d=u.test(a)?"":"</"+a+">",e=["<",a,h?' id="'+h:"",g?' class="'+g.trim()+'" ':"",i?i:"",">",b,d].join(""),c){var j=document.createElement("div");return j.innerHTML=e,j.firstChild}return e},o.get=function(a,b,c,d){var e=new XMLHttpRequest;e.open("get",a,3===arguments.length?!0:d),e.reponseType=b,e.onload=function(){4==e.readyState&&200==e.status&&c("json"===b?JSON.parse(e.response):e.response)},e.send()},o.getJSON=function(a,b,c){o.get(a,"json",b,c)},o}),function(a,b){"function"==typeof define&&define.amd?define("Lap",[],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Lap=b()}(this,function(){function a(a,c,d,e){var f=this;tooly.Handler.call(f),f.id=++b+0,f.container=a,f.lib=c,f.settings={};for(var g in f.defaultSettings)f.settings[g]=d.hasOwnProperty(g)?d[g]:f.defaultSettings[g];if(e||3===arguments.length)var h=setInterval(function(){"complete"===document.readyState&&(f.initialize(),clearInterval(h))},10);return f}var b=b||0,c=tooly.Frankie.bind(this);return tooly.inherit(tooly.Handler,a,function(){var a,b=_VOLUME_CHANGING=_PLAYLIST_OPEN=_DISCOG_OPEN=!1;return{defaultSettings:{callbacks:{},discogPlaylistExclusive:!0,plugins:{},prependTrackNumbers:!0,replacementText:void 0,startingAlbumIndex:0,startingTrackIndex:0,seekInterval:5,seekTime:250,selectorPrefix:"lap",trackNumberPostfix:" - ",useNativeProgress:!1,useNativeSeekRange:!1,useNativeVolumeRange:!1,volumeInterval:.05},selectors:{album:"lap-album",artist:"lap-artist",buffered:"lap-buffered",control:"lap-control",controls:"lap-controls",cover:"lap-cover",currentTime:"lap-current-time",discog:"lap-discog",discogItem:"lap-discog-item",discogPanel:"lap-discog-panel",duration:"lap-duration",info:"lap-info",infoPanel:"lap-info-panel",next:"lap-next",nextAlbum:"lap-next-album",playPause:"lap-play-pause",playlist:"lap-playlist",playlistItem:"lap-playlist-item",playlistPanel:"lap-playlist-panel",playlistTrackNumber:"lap-playlist-track-number",prev:"lap-prev",prevAlbum:"lap-prev-album",progress:"lap-progress",seekBackward:"lap-seek-backward",seekForward:"lap-seek-forward",seekRange:"lap-seek-range",trackNumber:"lap-track-number",trackTitle:"lap-track-title",volumeButton:"lap-volume-button",volumeDown:"lap-volume-down",volumeRead:"lap-volume-read",volumeRange:"lap-volume-range",volumeUp:"lap-volume-up"},initialize:function(){var a=this;1!==a.container.nodeType&&(a.container=c(a.container,document).get(0)),a.libType=tooly.type(a.lib),a.files=[],a.tracklist=[],a.$els=a.settings.elements,a.audio={},a.trackIndex=a.settings.startingTrackIndex,a.albumIndex=a.settings.startingAlbumIndex,a.trackCount,a.album="",a.trackTitle="",a.artist="",a.cover="",a.replacement="",a.update(),a.initAudio(),a.initElements(),a.addListeners(),a.registerCallbacks(a.settings.callbacks),a.initPlugins(),a.trigger("load")},initAudio:function(){this.audio=new Audio,this.audio.preload="auto";var a=this.getFileType(),b=this.audio.canPlayType("audio/"+a);"probably"===b||"maybe"===b?(this.setSource(),this.audio.volume=.8):console.log("This browser does not support "+a+" playback.")},initElements:function(){var a=this;a.$els={},tooly.each(a.selectors,function(b,d){var e=c("."+b,a.container);e.zilch()||(a.$els[d]=e)})},update:function(){var a=this;if("null"!==a.libType&&"undefined"!==a.libType){if("string"===a.libType){if("json"===tooly.extension(a.lib.toLowerCase())){if(tooly.getJSON(a.lib,function(b){a.lib=b},!1),"undefined"!==a.lib.data&&"array"===tooly.toType(a.lib.data))return a.lib=a.lib.data,a.libType=tooly.toType(a.lib),a.albumCount=a.lib.length,void a.update();if(a.libType=tooly.toType(a.lib),"object"===a.libType)return a.albumCount=tooly.propCount(a.lib),void a.update()}a.files=[a.lib],a.tracklist=[a.lib],a.trackIndex=0,a.albumIndex=0,a.startingTrackIndex=0,a.startingAlbumIndex=0}else{if("object"!==a.libType&&"array"!==a.libType)throw new TypeError("Lap.lib must be of type String (audio or json file), Object, or Array");var b="array"===a.libType?a.lib[a.albumIndex]:a.lib;a.artist=b.artist,a.album=b.album,a.files=b.files,a.cover=b.cover,a.tracklist=b.tracklist,a.replacement=b.replacement}if(void 0!==a.replacement){var c=a.replacement;if("string"===tooly.type(c)&&(c=[c,""]),"regexp"!==tooly.type(c[0])){var d=c[2];c[0]=void 0!==d?new RegExp(c[0],d):new RegExp(c[0],"g")}}a.trackCount="string"===tooly.type(a.files)?1:a.files.length,a.formatTracklist()}},formatTracklist:function(){var a=this;if(void 0===a.tracklist||a.trackCount>a.tracklist.length){for(var b=a.replacement,c=[],d=0;d<a.trackCount;d++)c[d]=tooly.sliceRel(tooly.stripExtension(a.files[d])),void 0!==b&&(c[d]=c[d].replace(b[0],b[1]));a.tracklist=c}},setSource:function(){var a=this.audio;a.src=this.files[this.trackIndex]},addListeners:function(){var a=this,b=a.$els,c=a.audio,d=a.settings.useNativeProgress&&b.progress&&b.progress.els.length;(b.buffered||d)&&c.addEventListener("progress",function(){var c=+a.bufferFormatted();b.buffered&&b.buffered.html(c),d&&(b.progress.get(0).value=c)}),b.currentTime&&c.addEventListener("timeupdate",function(){b.currentTime.html(a.currentTimeFormatted())}),b.duration&&c.addEventListener("durationchange",function(){b.duration.html(a.durationFormatted())}),b.volumeRead&&c.addEventListener("volumechange",function(){b.volumeRead.html(a.volumeFormatted())}),c.addEventListener("ended",function(){a.next(),a.audio.paused&&a.audio.play()}),b.playPause&&b.playPause.on("click",function(){a.togglePlay()}),b.prev&&b.prev.on("click",function(){a.prev()}),b.next&&b.next.on("click",function(){a.next()}),b.volumeUp&&b.volumeUp.on("click",function(){a.incVolume()}),b.volumeDown&&b.volumeDown.on("click",function(){a.decVolume()}),b.prevAlbum&&b.prevAlbum.on("click",function(){a.prevAlbum()}),b.nextAlbum&&b.nextAlbum.on("click",function(){a.nextAlbum()});var e=b.playlistPanel&&b.playlist,f=b.discogPanel&&b.discog;e&&b.playlist.on("click",function(){b.playlistPanel.hasClass("lap-hidden")?(b.playlistPanel.removeClass("lap-hidden"),_PLAYLIST_OPEN=!0,f&&a.settings.discogPlaylistExclusive&&b.discogPanel.addClass("lap-hidden")):(b.playlistPanel.addClass("lap-hidden"),_PLAYLIST_OPEN=!1,f&&a.settings.discogPlaylistExclusive&&_DISCOG_OPEN&&b.discogPanel.removeClass("lap-hidden"))}),f&&b.discog.on("click",function(){b.discogPanel.hasClass("lap-hidden")?(b.discogPanel.removeClass("lap-hidden"),_DISCOG_OPEN=!0,e&&a.settings.discogPlaylistExclusive&&b.playlistPanel.addClass("lap-hidden")):(b.discogPanel.addClass("lap-hidden"),_DISCOG_OPEN=!1,e&&a.settings.discogPlaylistExclusive&&_PLAYLIST_OPEN&&b.playlistPanel.removeClass("lap-hidden"))}),a.initSeekHandlers(),a.initVolumeHandlers(),a.on("load",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.artist&&a.updateArtistEl(),b.album&&a.updateAlbumEl(),b.cover&&a.updateCover(),b.playlistPanel&&a.populatePlaylist(),b.playPause&&(b.playPause.addClass("lap-paused"),a.on("play",function(){b.playPause.removeClass("lap-paused").addClass("lap-playing")}).on("pause",function(){b.playPause.removeClass("lap-playing").addClass("lap-paused")}))}).on("trackChange",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.playlistPanel&&a.updatePlaylistItem(),b.currentTime&&b.currentTime.html(a.currentTimeFormatted()),b.duration&&b.duration.html(a.durationFormatted())}).on("albumChange",function(){b.trackTitle&&a.updateTrackTitleEl(),b.trackNumber&&a.updateTrackNumberEl(),b.artist&&a.updateArtistEl(),b.album&&a.updateAlbumEl(),b.cover&&a.updateCover(),b.playlistPanel&&a.populatePlaylist()})},initSeekHandlers:function(){var d=this,e=d.$els,f=d.audio,g=e.seekRange,h=d.settings.useNativeSeekRange&&g&&g.els.length>0;h?(f.addEventListener("timeupdate",function(){b||(g.get(0).value=tooly.scale(f.currentTime,0,f.duration,0,100))}),g.on("mousedown",function(){b=!0}).on("mouseup",function(){var a=g.get(0);f.currentTime=tooly.scale(a.value,0,a.max,0,f.duration),d.trigger("seek"),b=!1})):[e.seekForward,e.seekBackward].forEach(function(e){e&&e.on("mousedown",function(a){b=!0,c(a.target).hasClass("lap-seek-forward")?d.seekForward():d.seekBackward()}).on("mouseup",function(){b=!1,clearTimeout(a)})})},initVolumeHandlers:function(){var a=this,b=a.$els,c=a.audio,d=b.volumeRange,e=a.settings.useNativeVolumeRange&&d&&d.els.length>0;e&&(c.addEventListener("volumechange",function(){_VOLUME_CHANGING||(d.get(0).value=a.volumeFormatted())}),d.on("mousedown",function(){_VOLUME_CHANGING=!0}).on("mouseup",function(){c.volume=.01*d.get(0).value,a.trigger("volumeChange"),_VOLUME_CHANGING=!1}))},initPlugins:function(){if(this.settings.plugins){this.plugins=this.plugins||[];var a=this,b=a.settings.plugins,c={},d=[];return b.forEach(function(b,e){b.constructor&&(c=b.args?tooly.construct(b.constructor,d.concat(a,b.args)):tooly.construct(b.constructor,a),a.plugins[e]=c,a.on("load",function(){if(!a.plugins[e]||!a.plugins[e].init)throw new Error("Could not initialize "+a.plugins[e]+". The plugin has no #init property");a.plugins[e].init()}))}),this}},updateTrackTitleEl:function(){var a=this;return a.$els.trackTitle.html(a.tracklist[a.trackIndex]),a},updateTrackNumberEl:function(){var a=this;return a.$els.trackNumber.html(a.trackIndex+1),a},updateArtistEl:function(){var a=this;return a.$els.artist.html(a.artist),a},updateAlbumEl:function(){var a=this;return a.$els.album.html(a.album),a},updateCover:function(){var a=this;return a.$els.cover.get(0).src=a.cover,a},togglePlay:function(){var a=this;return a.audio.paused?a.play():a.pause(),a.trigger("togglePlay"),a},play:function(){return this.audio.play(),this.trigger("play"),this},pause:function(){return this.audio.pause(),this.trigger("pause"),this},setTrack:function(a){return this.trackIndex=0>=a?0:a>=this.trackCount?this.trackCount-1:a,this.trigger("trackChange"),this},prev:function(){var a=this,b=!a.audio.paused;return a.trackIndex=a.trackIndex-1<0?a.trackCount-1:a.trackIndex-1,a.setSource(),b&&a.audio.play(),this.trigger("trackChange"),this},next:function(){var a=this,b=!a.audio.paused;return a.trackIndex=a.trackIndex+1>=a.trackCount?0:a.trackIndex+1,a.setSource(),b&&a.audio.play(),this.trigger("trackChange"),this},prevAlbum:function(){var a=this,b=!a.audio.paused;return a.albumIndex=a.albumIndex-1<0?a.albumCount-1:a.albumIndex-1,a.update(),a.trackIndex=0,a.setSource(),b&&a.audio.play(),this.trigger("albumChange"),this},nextAlbum:function(){var a=this,b=!a.audio.paused;return a.albumIndex=a.albumIndex+1>a.albumCount-1?0:a.albumIndex+1,a.update(),a.trackIndex=0,a.setSource(),b&&a.audio.play(),this.trigger("albumChange"),this},incVolume:function(){return this.setVolume(!0),this},decVolume:function(){return this.setVolume(!1),this},setVolume:function(a){var b=this.audio.volume,c=this.settings.volumeInterval;return this.audio.volume=a?b+c>=1?1:b+c:0>=b-c?0:b-c,this.trigger("volumeChange"),this},seekBackward:function(){if(b){var c=this;return a=setInterval(function(){c.seek(!1)},c.settings.seekTime),this}},seekForward:function(){if(b){var c=this;return a=setInterval(function(){c.seek(!0)},c.settings.seekTime),this}},seek:function(a){var b,c=this;return a?(b=c.audio.currentTime+c.settings.seekInterval,c.audio.currentTime=b>=c.audio.duration?c.audio.duration:b):(b=c.audio.currentTime+-1*c.settings.seekInterval,c.audio.currentTime=0>=b?0:b),this.trigger("seek"),this},populatePlaylist:function(){var a=this,b=a.$els.playlistPanel,d=a.settings.prependTrackNumbers;b.remove(),b.html(tooly.tag("ul",a.tracklist.map(function(b,c){var e="li .lap-playlist-item "+(c===a.trackIndex?".lap-playlist-current ":"")+'data-lap-playlist-index="'+c+'"';return tooly.tag(e,tooly.stringFormat("{0}{1}",d?tooly.tag("span .lap-playlist-track-number",a.trackNumberFormatted(c+1)):"",tooly.tag("span .lap-playlist-track-title",a.tracklist[c].trim())))}).join(""))),b.find("li").on("click",function(){var b=c(this);a.setTrack(b.attr("data-lap-playlist-index"))})},playlistFormatted:function(){var a=this,b=a.settings.prependTrackNumbers;return a.tracklist.map(function(c,d){return(b?a.trackNumberFormatted(d+1):"")+c.trim()})},updatePlaylistItem:function(){var a=this;return c("li",a.$els.playlistPanel).removeClass("lap-playlist-current").eq(a.trackIndex).addClass("lap-playlist-current"),a},getFileType:function(){var a;return"string"===this.libType?a=this.lib:"object"===this.libType?a=1===this.trackCount?this.lib.files:this.lib.files[this.trackIndex]:"array"===this.libType&&(a=1===this.trackCount?this.lib[this.albumIndex].files:this.lib[this.albumIndex].files[this.trackIndex]),void 0===a?'"unknown filetype"':tooly.extension(a)},bufferFormatted:function(){if(!this.audio)return 0;var a,b=this.audio;try{a=b.buffered.end(b.buffered.length-1)}catch(c){return 0}var d=Math.round(tooly.scale(a,0,b.duration,0,100));return isNaN(d)?0:d},currentTimeFormatted:function(){var a=tooly.formatTime(Math.floor(this.audio.currentTime.toFixed(1)));return this.audio.duration<3600||"00:00:00"===a?a.slice(3):a},durationFormatted:function(){var a=tooly.formatTime(Math.floor(this.audio.duration.toFixed(1)));return this.audio.duration<3600?a.slice(3):a},volumeFormatted:function(){return Math.round(100*this.audio.volume)},trackNumberFormatted:function(a){var b=(""+this.trackCount).length-(""+a).length;return tooly.repeat("0",b)+a+this.settings.trackNumberPostfix},property:function(a){if("object"===this.libType&&this.lib.hasOwnProperty(a))return this.lib[a];if("array"===this.libType){for(var b=[],c=this.lib.length,d=0;c>d;d++)this.lib[d].hasOwnProperty(a)&&(b[d]=this.lib[d][a]);return b}},getTooly:function(){return tooly},getSelector:function(){return c},toString:function(){return JSON.stringify(this)}}}()),a});