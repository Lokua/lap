{"version":3,"sources":["../src/lap.js"],"names":[],"mappings":"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","file":"lap.js","sourcesContent":["/*>>*/\r\nconst logger = new Logger('Lap', {\r\n  level: 0,\r\n  nameStyle: 'color:rgb(10, 102, 85)'\r\n});\r\n/*<<*/\r\n\r\nconst _ = tooly;\r\nconst $ = _.Frankie;\r\nconst IS_MOBILE = true; // temp fix as we don't give a shit about volume for now...\r\n\r\nconst $$instances = Symbol();\r\nconst $$defaultSettings = Symbol();\r\nconst $$defaultSelectors = Symbol();\r\nconst $$audioExtensionRegExp = Symbol();\r\n\r\nexport default class Lap extends Bus {\r\n\r\n  constructor(element, lib, options, postpone=false) {\r\n    super();\r\n    this.id = options && options.id ? options.id : Lap[$$instances].length;\r\n    this.element = element;\r\n    this.container = document.querySelector(element);\r\n    this.settings = _.extend({}, Lap[$$defaultSettings], options);\r\n    this.lib = lib;\r\n    if (!postpone) this.initialize();\r\n\r\n    /*>>*/\r\n    const echo = e => this.on(e, () => logger.info('%c%s handler called', 'color:#800080', e));\r\n    echo('load');\r\n    echo('play');\r\n    echo('pause');\r\n    echo('seek');\r\n    echo('trackChange');\r\n    echo('albumChange');\r\n    echo('volumeChange');\r\n    /*<<*/\r\n\r\n    Lap[$$instances].push(this);\r\n    return this;\r\n  }\r\n\r\n  static getInstance(id) {\r\n    return Lap[$$instances][id];\r\n  }\r\n\r\n  static setLib(lib) {\r\n    if (Array.isArray(lib)) return (this.lib = lib);\r\n    if (typeof lib === 'string' && Lap[$$audioExtensionRegExp].test(lib)) {\r\n      return (this.lib = [{ files: lib }]);\r\n    }\r\n    if (typeof lib === 'object') return (this.lib = [lib]);\r\n    throw new TypeError(`${lib} must be an array, object, or string`);\r\n  }\r\n\r\n  initialize() {\r\n    this.SEEKING = false;\r\n    this.VOLUME_CHANGING = false;\r\n    this.MOUSEDOWN_TIMER = 0;\r\n    this.PLAYING = false;\r\n\r\n    this.plugins = this.settings.plugins;\r\n    this.playlistPopulated = false;\r\n\r\n    this.albumIndex = this.settings.startingAlbumIndex;\r\n    this.albumCount = this.lib.length;\r\n\r\n    this.update();\r\n    this.initAudio();\r\n    this.initElements();\r\n    this.addAudioListeners();\r\n    if (!IS_MOBILE) this.addVolumeListeners();\r\n    this.addSeekListeners();\r\n    this.addListeners();\r\n\r\n    _.each(this.settings.callbacks, (fn, key) => this.on(key, fn));\r\n    this.activatePlugins();\r\n\r\n    /*>>*/logger.debug('initialize >> instance #%o: %o', this.id, this);/*<<*/\r\n\r\n    this.trigger('load');\r\n  }\r\n\r\n  activatePlugins() {\r\n    this.plugins.forEach((plugin, i) => {\r\n      this.plugins[i] = new plugin(this); /* jshint ignore:line */\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Configures instance variables relative to the current album.\r\n   * Called on initialization and whenever an album is changed.\r\n   *\r\n   * @return {Lap} this\r\n   */\r\n  update() {\r\n    this.trackIndex = this.settings.startingTrackIndex;\r\n    this.playlistPopulated = false;\r\n\r\n    const currentLibItem = this.lib[this.albumIndex];\r\n\r\n    ['artist', 'album', 'files', 'cover', 'tracklist', 'replacement'].forEach(key =>\r\n      this[key] = currentLibItem[key]);\r\n\r\n    this.trackCount = this.files.length;\r\n\r\n    if (this.replacement !== undefined) {\r\n      let re = this.replacement;\r\n      /* for replacment without value specified, empty string */\r\n      if (_.type(re) === 'string') re = [re, ''];\r\n      /* re may contain string-wrapped regexp (from json), convert if so */\r\n      if (_.type(re[0]) !== 'regexp') {\r\n        const flags = re[2];\r\n        re[0] = new RegExp(re[0], flags !== undefined ? flags : 'g');\r\n      }\r\n    }\r\n    this.formatTracklist();\r\n    return this;\r\n  }\r\n\r\n  initAudio() {\r\n    this.audio = new Audio();\r\n    this.audio.preload = 'auto';\r\n    const fileType = this.getFileType();\r\n    const canPlay = this.audio.canPlayType('audio/' + fileType);\r\n    if (canPlay === 'probably' || canPlay === 'maybe') {\r\n      this.setSource();\r\n      this.audio.volume = 1;\r\n    } else {\r\n      // TODO: return a flag to signal skipping the rest of the initialization process\r\n      console.warn(`This browser does not support ${filetype} playback.`);\r\n    }\r\n  }\r\n\r\n  setSource() {\r\n    this.audio.src = this.files[this.trackIndex];\r\n    return this;\r\n  }\r\n\r\n  getFileType() {\r\n    const f = this.files[this.trackIndex];\r\n    return f.substr(0, f.lastIndexOf('.'));\r\n  }\r\n\r\n  initElements() {\r\n    this.els = {};\r\n    this.selectors = Object.keys(Lap[$$defaultSelectors]).map(key => {\r\n      return this.settings.selectors[key] || Lap[$$defaultSelectors][key];\r\n    });\r\n    Object.keys(this.selectors).forEach((sel, key) => {\r\n      if (_.type(sel) === 'object') return;\r\n      const el = document.querySelector(`.${sel}`, this.element);\r\n      if (el) this.els[key] = el;\r\n    });\r\n  }\r\n\r\n  addAudioListeners() {\r\n    const audio = this.audio;\r\n    const els = this.els;\r\n\r\n    if (els.buffered || (this.settings.useNativeProgress && els.progress)) {\r\n      audio.addEventListener('progress', () => {\r\n        // TODO: verify if this really needs to be type cast...\r\n        var buffered = +this.bufferFormatted();\r\n        if (els.buffered) els.buffered.outerHTML = buffered;\r\n        if (nativeProgress) els.progress.value = buffered;\r\n      });\r\n    }\r\n    if (els.currentTime) {\r\n      audio.addEventListener('timeupdate', () => {\r\n        els.currentTime.outerHTML = this.currentTimeFormatted();\r\n      });\r\n    }\r\n    if (els.duration) {\r\n      audio.addEventListener('durationchange', () => {\r\n        els.duration.outerHTML = this.durationFormatted();\r\n      });\r\n    }\r\n    if (!IS_MOBILE && els.volumeRead) {\r\n      audio.addEventListener('volumechange', () => {\r\n        els.volumeRead.outerHTML = this.volumeFormatted();\r\n      });\r\n    }\r\n    audio.addEventListener('ended', () => {\r\n      /*>>*/logger.debug('ended > this.audio.paused: %o', this.audio.paused);/*<<*/\r\n      if (this.PLAYING) {\r\n        this.next();\r\n        this.audio.play();\r\n      }\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  addListeners() {\r\n    const els = this.els;\r\n\r\n    if (els.playPause) els.playPause.addEventListener('click', () => this.togglePlay());\r\n    if (els.prev) els.prev.addEventListener('click', () => this.prev());\r\n    if (els.next) els.next.addEventListener('click', () => this.next());\r\n    if (!IS_MOBILE) {\r\n      if (els.volumeUp) els.volumeUp.addEventListener('click', () => this.incVolume());\r\n      if (els.volumeDown) els.volumeDown.addEventListener('click', () => this.decVolume());\r\n    }\r\n    if (els.prevAlbum) els.prevAlbum.addEventListener('click', () => this.prevAlbum());\r\n    if (els.nextAlbum) els.nextAlbum.addEventListener('click', () => this.nextAlbum());\r\n    if (els.discog) els.discog.addEventListener('click', () => this.trigger('discogClick'));\r\n    if (els.playlist) els.playlist.addEventListener('click', () => this.trigger('playlistClick'));\r\n\r\n    // this\r\n    //   .on('load', () => {\r\n    //     if (els.trackTitle) this.updateTrackTitleEl();\r\n    //     if (els.trackNumber) this.updateTrackNumberEl();\r\n    //     if (els.artist) this.updateArtistEl();\r\n    //     if (els.album) this.updateAlbumEl();\r\n    //     if (els.cover) this.updateCover();\r\n    //     if (els.playPause) {\r\n    //       els.playPause.addClass(this.selectors.state.paused);\r\n    //       this\r\n    //         .on('play', () => {\r\n    //           els.playPause\r\n    //             .removeClass(this.selectors.state.paused)\r\n    //             .addClass(this.selectors.state.playing);\r\n    //         })\r\n    //         .on('pause', () => {\r\n    //           els.playPause\r\n    //             .removeClass(this.selectors.state.playing)\r\n    //             .addClass(this.selectors.state.paused);\r\n    //         });\r\n    //     }\r\n    //   })\r\n    //   .on('trackChange', () => {\r\n    //     if (els.trackTitle) this.updateTrackTitleEl();\r\n    //     if (els.trackNumber) this.updateTrackNumberEl();\r\n    //     if (els.currentTime) els.currentTime.html(this.currentTimeFormatted());\r\n    //     if (els.duration) els.duration.html(this.durationFormatted());\r\n    //   })\r\n    //   .on('albumChange', () => {\r\n    //     if (els.trackTitle) this.updateTrackTitleEl();\r\n    //     if (els.trackNumber) this.updateTrackNumberEl();\r\n    //     if (els.artist) this.updateArtistEl();\r\n    //     if (els.album) this.updateAlbumEl();\r\n    //     if (els.cover) this.updateCover();\r\n    //   });\r\n  }\r\n\r\n  addSeekListeners() {\r\n    const els = this.els;\r\n    const audio = this.audio;\r\n    const seekRange = els.seekRange;\r\n    const nativeSeek = this.settings.useNativeSeekRange && seekRange && seekRange.els.length;\r\n\r\n    if (nativeSeek) {\r\n      audio.addEventListener('timeupdate', e => {\r\n        if (!this.SEEKING) {\r\n          seekRange.get(0).value = _.scale(audio.currentTime, 0, audio.duration, 0, 100);\r\n        }\r\n      });\r\n      seekRange\r\n        .on('mousedown', e => {\r\n          this.SEEKING = true;\r\n        })\r\n        .on('mouseup', e => {\r\n          var el = seekRange.get(0);\r\n          if (!el.value) this.logger.debug('what the fuck! ' + el);\r\n          audio.currentTime = _.scale(el.value, 0, el.max, 0, audio.duration);\r\n          this.trigger('seek');\r\n          this.SEEKING = false;\r\n        });\r\n\r\n    } else { // using buttons\r\n      [els.seekForward, els.seekBackward].forEach(el => {\r\n        if (!el) return;\r\n        el\r\n          .on('mousedown', e => {\r\n            this.SEEKING = true;\r\n            if ($(e.target).hasClass(this.selectors.seekForward)) {\r\n              this.seekForward();\r\n            } else {\r\n              this.seekBackward();\r\n            }\r\n          })\r\n          .on('mouseup', e => {\r\n            this.SEEKING = false;\r\n            clearTimeout(this.MOUSEDOWN_TIMER);\r\n          });\r\n      });\r\n    }\r\n  }\r\n\r\n  addVolumeListeners() {\r\n    if (IS_MOBILE) return this;\r\n\r\n    const lap = this;\r\n    const els = this.els;\r\n    const audio = this.audio;\r\n    const vslider = els.volumeRange;\r\n\r\n    if (this.settings.useNativeVolumeRange && vslider && vslider.els.length) {\r\n      audio.addEventListener('volumechange', () => {\r\n        if (!this.VOLUME_CHANGING) {\r\n          vslider.get(0).value = this.volumeFormatted();\r\n        }\r\n      });\r\n      vslider\r\n        .on('mousedown', () => {\r\n          this.VOLUME_CHANGING = true;\r\n        })\r\n        .on('mouseup', () => {\r\n          audio.volume = vslider.get(0).value * 0.01;\r\n          this.trigger('volumeChange');\r\n          this.VOLUME_CHANGING = false;\r\n        });\r\n    }\r\n  }\r\n\r\n  incVolume() {\r\n    if (IS_MOBILE) return this;\r\n    this.setVolume(true);\r\n    return this;\r\n  }\r\n\r\n  decVolume() {\r\n    if (IS_MOBILE) return this;\r\n    this.setVolume(false);\r\n    return this;\r\n  }\r\n\r\n  setVolume(up) {\r\n    if (IS_MOBILE) return this;\r\n    var vol = this.audio.volume,\r\n        interval = this.settings.volumeInterval;\r\n    if (up) {\r\n      this.audio.volume = (vol + interval >= 1) ? 1 : vol + interval;\r\n    } else {\r\n      this.audio.volume = (vol - interval <= 0) ? 0 : vol - interval;\r\n    }\r\n    this.trigger('volumeChange');\r\n    return this;\r\n  }\r\n\r\n  volumeFormatted() {\r\n    return Math.round(this.audio.volume * 100);\r\n  }\r\n\r\n  /**\r\n   * Add a plug-in instance to the plugins hash\r\n   * @param  {String} key    the plugin instance identifier\r\n   * @param  {Object} plugin the plugin instance (not the class)\r\n   * @return {Lap}           this\r\n   */\r\n  registerPlugin(key, plugin) {\r\n    this.plugins[key] = plugin;\r\n  }\r\n\r\n  updateTrackTitleEl() {\r\n    this.els.trackTitle.outerHTML = this.tracklist[this.trackIndex];\r\n    return this;\r\n  }\r\n\r\n  updateTrackNumberEl() {\r\n    this.els.trackNumber.outerHTML = +this.trackIndex+1;\r\n    return this;\r\n  }\r\n\r\n  updateArtistEl() {\r\n    this.els.artist.outerHTML = this.artist;\r\n    return this;\r\n  }\r\n\r\n  updateAlbumEl() {\r\n    this.els.album.outerHTML = this.album;\r\n    return this;\r\n  }\r\n\r\n  updateCover() {\r\n    this.els.cover.get(0).src = this.cover;\r\n    return this;\r\n  }\r\n\r\n  togglePlay() {\r\n    this.audio.paused ? this.play() : this.pause();\r\n    this.trigger('togglePlay');\r\n    return this;\r\n  }\r\n\r\n  play() {\r\n    this.audio.play();\r\n    this.PLAYING = true;\r\n    this.trigger('play');\r\n    return this;\r\n  }\r\n\r\n  pause() {\r\n    this.audio.pause();\r\n    this.PLAYING = false;\r\n    this.trigger('pause');\r\n    return this;\r\n  }\r\n\r\n  setTrack(index) {\r\n    if (index <= 0) {\r\n      this.trackIndex = 0;\r\n    } else if (index >= this.trackCount) {\r\n      this.trackIndex = this.trackCount-1;\r\n    } else {\r\n      this.trackIndex = index;\r\n    }\r\n    const wasPlaying = !this.audio.paused;\r\n    this.setSource();\r\n    if (wasPlaying) this.audio.play();\r\n    this.trigger('trackChange');\r\n    return this;\r\n  }\r\n\r\n  prev() {\r\n    const wasPlaying = !this.audio.paused;\r\n    this.trackIndex = (this.trackIndex-1 < 0) ? this.trackCount-1 : this.trackIndex-1;\r\n    this.setSource();\r\n    if (wasPlaying) this.audio.play();\r\n    this.trigger('trackChange');\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    const wasPlaying = !this.audio.paused;\r\n    this.trackIndex = (this.trackIndex+1 >= this.trackCount) ? 0 : this.trackIndex+1;\r\n    this.setSource();\r\n    if (wasPlaying) this.audio.play();\r\n    this.trigger('trackChange');\r\n    return this;\r\n  }\r\n\r\n  prevAlbum() {\r\n    const wasPlaying = !this.audio.paused;\r\n    this.albumIndex = (this.albumIndex-1 < 0) ? this.albumCount-1 : this.albumIndex-1;\r\n    this.update();\r\n    this.trackIndex = 0;\r\n    this.setSource();\r\n    if (wasPlaying) this.audio.play();\r\n    this.trigger('albumChange');\r\n    return this;\r\n  }\r\n  nextAlbum() {\r\n    const wasPlaying= !this.audio.paused;\r\n    this.albumIndex = (this.albumIndex+1 > this.albumCount-1) ? 0 : this.albumIndex+1;\r\n    this.update();\r\n    this.trackIndex = 0;\r\n    this.setSource();\r\n    if (wasPlaying) this.audio.play();\r\n    this.trigger('albumChange');\r\n    return this;\r\n  }\r\n  setAlbum(index) {\r\n    if (index <= 0) {\r\n      this.albumIndex = 0;\r\n    } else if (index >= this.albumCount) {\r\n      this.albumIndex = this.albumCount-1;\r\n    } else {\r\n      this.albumIndex = index;\r\n    }\r\n    this.update();\r\n    this.setTrack(this.lib[this.albumIndex].startingTrackIndex || 0);\r\n    this.trigger('albumChange');\r\n    return this;\r\n  }\r\n\r\n  seekBackward() {\r\n    if (!this.SEEKING) return this;\r\n    this.MOUSEDOWN_TIMER = setInterval(() => {\r\n      const applied = this.audio.currentTime + (this.settings.seekInterval * -1);\r\n      this.audio.currentTime = applied <= 0 ? 0 : applied;\r\n    }, this.settings.seekTime);\r\n    return this;\r\n  }\r\n\r\n  seekForward() {\r\n    if (!this.SEEKING) return this;\r\n    this.MOUSEDOWN_TIMER = setInterval(() => {\r\n      const applied = this.audio.currentTime + this.settings.seekInterval;\r\n      this.audio.currentTime = applied >= this.audio.duration ? this.audio.duration : applied;\r\n    }, this.settings.seekTime);\r\n    return this;\r\n  }\r\n\r\n  formatTracklist() {\r\n    /* don't fuck with the user's tracklist */\r\n    if (_.truthy(this.tracklist)) {\r\n      return this;\r\n    }\r\n    const re = this.replacement;\r\n    const tracklist = []; // let?\r\n    for (let i = 0; i < this.trackCount; i++) {\r\n      tracklist[i] = _.sliceRel(_.stripExtension(this.files[i]));\r\n      if (_.truthy(re)) {\r\n        tracklist[i] = tracklist[i].replace(re[0], re[1]);\r\n      }\r\n      tracklist[i] = tracklist[i].trim();\r\n    }\r\n    this.tracklist = tracklist;\r\n    return this;\r\n  }\r\n\r\n  bufferFormatted() {\r\n    if (!this.audio) return 0;\r\n\r\n    const audio = this.audio;\r\n    let buffered;\r\n\r\n    try {\r\n      buffered = audio.buffered.end(audio.buffered.length-1);\r\n    } catch(e) {\r\n      return 0;\r\n    }\r\n    var formatted = Math.round(_.scale(buffered, 0, audio.duration, 0, 100));\r\n    return isNaN(formatted) ? 0 : formatted;\r\n  }\r\n\r\n  currentTimeFormatted() {\r\n    if (isNaN(this.audio.duration)) {\r\n      return '00:00';\r\n    }\r\n    var formatted = _.formatTime(Math.floor(this.audio.currentTime.toFixed(1)));\r\n    if (this.audio.duration < 3600 || formatted === '00:00:00') {\r\n      return formatted.slice(3); // nn:nn\r\n    }\r\n    return formatted;\r\n  }\r\n\r\n  durationFormatted() {\r\n    if (isNaN(this.audio.duration)) {\r\n      return '00:00';\r\n    }\r\n    var formatted = _.formatTime(Math.floor(this.audio.duration.toFixed(1)));\r\n    if (this.audio.duration < 3600 || formatted === '00:00:00') {\r\n      return formatted.slice(3); // nn:nn\r\n    }\r\n    return formatted;\r\n  }\r\n\r\n  trackNumberFormatted(n) {\r\n    var count = (''+this.trackCount).length - (''+n).length;\r\n    return _.repeat('0', count) + n + this.settings.trackNumberPostfix;\r\n  }\r\n\r\n  /**\r\n   * Convenience method to grab a property from the currently cued album. A\r\n   * second argument can be passed to choose a specific album.\r\n   * @method get\r\n   * @param  {String} what the property\r\n   * @return {[type]}      [description]\r\n   */\r\n  get(key, index) {\r\n    return this.lib[index === undefined ? this.albumIndex : index][key];\r\n  }\r\n\r\n}\r\n\r\nLap[$$instances] = [];\r\n\r\nLap[$$audioExtensionRegExp] = /mp3|wav|ogg|aiff/i;\r\n\r\nLap[$$defaultSettings] = {\r\n  callbacks: {},\r\n  discogPlaylistExclusive: true,\r\n  plugins: [],\r\n  prependTrackNumbers: true,\r\n  replacementText: void 0,\r\n  startingAlbumIndex: 0,\r\n  startingTrackIndex: 0,\r\n  seekInterval: 5,\r\n  seekTime: 250,\r\n  selectors: {}, // see #initElements\r\n  selectorPrefix: 'lap',\r\n  trackNumberPostfix: ' - ',\r\n  useNativeProgress: false,\r\n  useNativeSeekRange: false,\r\n  useNativeVolumeRange: false,\r\n  volumeInterval: 0.05,\r\n  $: !() => {\r\n    if (tooly && tooly.Frankie) return tooly.Frankie;\r\n    return jQuery || Zepto || Bondo || new Error('Could not find a default selector library');\r\n  }()\r\n};\r\n\r\nLap[$$defaultSelectors] = {\r\n  state: {\r\n    playlistItemCurrent:  'lap__playlist__item--current',\r\n    playing:              'lap--playing',\r\n    paused:               'lap--paused',\r\n    hidden:               'lap--hidden'\r\n  },\r\n  album:               'lap__album',\r\n  artist:              'lap__artist',\r\n  buffered:            'lap__buffered',\r\n  cover:               'lap__cover',\r\n  currentTime:         'lap__current-time',\r\n  discog:              'lap__discog',\r\n  discogItem:          'lap__discog__item',\r\n  discogPanel:         'lap__discog__panel',\r\n  duration:            'lap__duration',\r\n  info:                'lap__info', // button\r\n  infoPanel:           'lap__info-panel',\r\n  next:                'lap__next',\r\n  nextAlbum:           'lap__next-album',\r\n  playPause:           'lap__play-pause',\r\n  playlist:            'lap__playlist', // button\r\n  playlistItem:        'lap__playlist__item', // list item\r\n  playlistPanel:       'lap__playlist__panel',\r\n  playlistTrackNumber: 'lap__playlist__track-number',\r\n  playlistTrackTitle:  'lap__playlist__track-title',\r\n  prev:                'lap__prev',\r\n  prevAlbum:           'lap__prev-album',\r\n  progress:            'lap__progress',\r\n  seekBackward:        'lap__seek-backward',\r\n  seekForward:         'lap__seek-forward',\r\n  seekRange:           'lap__seek-range',\r\n  trackNumber:         'lap__track-number', // the currently cued track\r\n  trackTitle:          'lap__track-title',\r\n  volumeButton:        'lap__volume-button',\r\n  volumeDown:          'lap__volume-down',\r\n  volumeRead:          'lap__volume-read',\r\n  volumeRange:         'lap__volume-range',\r\n  volumeUp:            'lap__volume-up'\r\n};\r\n"]}